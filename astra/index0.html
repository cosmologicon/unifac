<!doctype html>
<!-- Unminified version available at: https://code.google.com/p/unifac/source/browse/#hg%2Fastra -->
<title>Ad Astra</title>
<canvas id="canvas"></canvas>
<script>function(){var t=t||{};t.resource={images:{},sounds:{},data:{},jsontypes:"js json".split(" "),imagetypes:"png gif jpg jpeg bmp tiff".split(" "),soundtypes:"wav mp3 ogg au".split(" "),rawtypes:"csv txt frag vert".split(" "),base:null,soundvolume:undefined,musicvolume:undefined,audiovolume:undefined,onload:function(){},onloading:function(ag){},load:function(){var ai=t.resource._extractlist(arguments);for(var ag=0;ag<ai.length;++ag){var ah=ai[ag];this._load(ah[0],ah[1])}if(this._toload===0){setTimeout(this.onload,0)}},loadimage:function(){var ai=this._extractlist(arguments);for(var ag=0;ag<ai.length;++ag){var ah=ai[ag];this._loadimage(ah[0],ah[1])}},loadsound:function(){var ai=this._extractlist(arguments);for(var ag=0;ag<ai.length;++ag){var ah=ai[ag];this._loadsound(ah[0],ah[1])}},loadjson:function(){var ai=this._extractlist(arguments);for(var ag=0;ag<ai.length;++ag){var ah=ai[ag];this._loadjson(ah[0],ah[1])}},loadwebfonts:function(){g={google:{families:Array.prototype.slice.call(arguments)},fontactive:t.resource._onload};var ag=document.createElement("script");ag.src="https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";ag.type="text/javascript";ag.async="true";document.getElementsByTagName("head")[0].appendChild(ag);this._toload+=arguments.length},setsoundvolume:function(ag){this.soundsvolume=ag},setmusicvolume:function(ag){this.musicvolume=ag;if(this.musicplaying){this.musicplaying.volume=this._getmusicvolume()}},setaudiovolume:function(ag){this.audiovolume=ag;if(this.musicplaying){this.musicplaying.volume=this._getmusicvolume()}},playsound:function(ag){var ai=this.sounds[ag];if(!ai){console.log("Missing sound: "+ag);return}var ah=this.soundvolume===undefined?this.audiovolume:this.soundvolume;if(ah===undefined){ah=1}ai.volume=ah;ai.play()},musicplaying:null,_getmusicvolume:function(){if(this.musicvolume!==undefined){return this.musicvolume}if(this.audiovolume!==undefined){return this.audiovolume}return 1},playmusic:function(ah,ai){this._completependingfades();if(!ah){return this.stopmusic()}var ag=this.sounds[ah];if(!ag){console.log("Missing music: "+ah);return}if(ag===this.musicplaying){return}this.stopmusic();ag.volume=this._getmusicvolume();ag.currentTime=0;ag.play();ag.loop=!ai;this.musicplaying=ag},stopmusic:function(){this._completependingfades();if(this.musicplaying){this.musicplaying.pause()}this.musicplaying=null},_fadeouttime0:1400,_fadeintime0:1400,_fadegap0:0,setfadetime:function(ai,ah,ag){if(ai!==undefined){this._fadeouttime0=ai}if(ah!==undefined){this._fadeintime0=ah}if(ag!==undefined){this._fadegap0=ag}},setcrossfade:function(ag){if(ag===undefined){ag=this._fadetime}this.setfadetime(ag,ag,-ag)},_completependingfades:function(){if(this._fadetimeout){window.clearTimeout(this._fadetimeout);this._fadeinstart=-1;this._fadeoutstart=-1;this._fadecallback()}},fadetomusic:function(aj,ai,ah,ag,ak){this._completependingfades();if(this.musicplaying&&aj&&this.sounds[aj]===this.musicplaying){return}this._fadeouttime=ai===undefined?this._fadeouttime0:ai;this._fadeintime=ah===undefined?this._fadeintime0:ah;this._fadegap=ag===undefined?this._fadegap0:ag;this._fadeoutstart=Date.now();this._fadeinstart=this._fadeoutstart+(this.musicplaying?this._fadeintime+this._fadegap:0);this._pendingmname=aj;this._pendingnoloop=ak;this._outgoingmusic=this.musicplaying;this.musicplaying=null;this._fadecallback()},crossfadetomusic:function(ah,ag,ai){if(ag===undefined){ag=this._fadeouttime}this.fadetomusic(ah,ag,ag,-ag,ai)},_fadecallback:function(){if(this._outgoingmusic){var ah=Date.now()-this._fadeoutstart;var ai=this._fadeouttime>0?1-ah/this._fadeouttime:ah>0?0:1;if(ai>0){this._outgoingmusic.volume=ai*this._getmusicvolume()}else{this._outgoingmusic.pause();this._outgoingmusic=null}}if(this._pendingmname){var aj=Date.now()-this._fadeinstart;var ak=this._fadeintime>0?aj/this._fadeintime:aj>0?1:0;if(ak>0){if(!this.musicplaying){var ag=this.sounds[this._pendingmname];if(!ag){console.log("Missing music: "+y)}else{ag.currentTime=0;ag.volume=0;ag.play();ag.loop=!this._pendingnoloop;this.musicplaying=ag}}if(ak>=1){this.musicplaying.volume=this._getmusicvolume();this._pendingmname=null}else{this.musicplaying.volume=ak*this._getmusicvolume()}}}if(this._outgoingmusic||this._pendingmname){this._fadetimeout=window.setTimeout(this._fadecallback.bind(this),100)}else{this._fadetimeout=null}},Multisound:function(ag,ah){if(!(this instanceof t.resource.Multisound)){return new t.resource.SoundRandomizer(ag,ah)}this._init(ag,ah)},SoundRandomizer:function(ah,ai){if(!(this instanceof t.resource.SoundRandomizer)){return new t.resource.SoundRandomizer(ah,ai)}this._sounds=[];for(var ag=0;ag<ah.length;++ag){this._sounds.push(typeof ah[ag]=="string"?t.resource.sounds[ah[ag]]:ah[ag])}this._nskip=Math.min(this._sounds.length-1,(ai||3));this._played=[];this.volume=1},mergesounds:function(){for(var ah=0;ah<arguments.length;++ah){var ai=[],ag=arguments[ah];for(var aj in t.resource.sounds){if(aj.indexOf(ag)==0){ai.push(aj)}}this.sounds[ag]=this.SoundRandomizer(ai)}},_seturl:function(ag){if(!this.base){return ag}var ah=t.resource.base.length;if(!ah){return ag}return this.base+(this.base.charAt(ah-1)=="/"?"":"/")+ag},_load:function(ah,ag){var ai=ag.split(".").pop();if(this.imagetypes.indexOf(ai)>-1){return this._loadimage(ah,ag)}else{if(this.soundtypes.indexOf(ai)>-1){return this._loadsound(ah,ag)}else{if(this.jsontypes.indexOf(ai)>-1){return this._loadjson(ah,ag)}else{if(this.rawtypes.indexOf(ai)>-1){return this._loaddata(ah,ag)}}}}console.log("Treating unknown extension "+ai+" as raw data");return this._loaddata(ah,ag)},_loadimage:function(ah,ai){var ag=new Image();ag.onload=this._onload;ag.src=this._seturl(ai);ag.iname=ah;this.images[ah]=ag;++this._toload},_loadsound:function(ah,ag){var ai=new Audio();ai.addEventListener("canplaythrough",this._onload,false);ai.src=this._seturl(ag);ai.aname=ah;this.sounds[ah]=ai;++this._toload},_loadjson:function(ag,aj){var ah=new XMLHttpRequest();ah.overrideMimeType("application/json");ah.open("GET",aj,true);var ai=this;ah.onload=function(){t.resource.data[ag]=JSON.parse(ah.responseText);t.resource._onload()};ah.send(null);++this._toload},_loaddata:function(aj,ag){var ah=new XMLHttpRequest();ah.open("GET",ag,true);var ai=this;ah.onload=function(){t.resource.data[aj]=ah.responseText;t.resource._onload()};ah.send(null);++this._toload},_extractlist:function(ak){var aj=[];for(var ai=0;ai<ak.length;++ai){var ag=ak[ai];if(typeof ag=="string"){aj.push([ag,ag])}else{if(ag instanceof Array){for(var ah=0;ah<ag.length;++ah){aj.push([ag[ah],ag[ah]])}}else{for(var ah in ag){aj.push([ah,ag[ah]])}}}}return aj},_toload:0,_loaded:0,_onload:function(){++t.resource._loaded;var ag=this._loaded/this._toload;t.resource.onloading(ag);if(t.resource._loaded==t.resource._toload){t.resource.onload()}}};var g;t.resource.Multisound.prototype={_init:function(ah,aj){this.src=typeof ah=="string"?ah:ah.src;this._sounds=[];this._n=aj||10;this._k=0;this.volume=1;for(var ag=0;ag<this._n;++ag){var ai=new Audio();ai.src=this.src;this._sounds.push(ai)}},play:function(){var ag=this._sounds[this._k++];this._k%=this._n;ag.volume=this.volume;ag.play()},pause:function(){for(var ag=0;ag<this._n;++ag){this._sounds[ag].pause()}}};t.resource.SoundRandomizer.prototype={play:function(){do{var ag=t.random.rand(this._sounds.length)}while(this._played.indexOf(ag)>-1);var ah=this._sounds[ag];ah.volume=this.volume;ah.play();if(this._nskip){this._played.push(ag);while(this._played.length>=this._nskip){this._played=this._played.slice(1)}}},pause:function(){for(var ag=0;ag<this._sounds.length;++ag){this._sounds[ag].pause()}}};"use strict";var t=t||{};t._draw=function(){var ao=[];function ak(){for(var at=0;at<arguments.length;++at){var ar=arguments[at];if(ar.split){ao.push.apply(ao,ar.split(" "))}else{if(ar instanceof Array){ak.apply(this,ar)}else{ao.push(ar)}}}}ak.apply(this,arguments);var ap=this;function ah(ar){if(typeof ar!=="string"){return ar}switch(ar.substr(0,3)){case"lg~":return t._draw.lingrad.apply(ap,ar.substr(3).split("~"));case"rg~":return t._draw.radgrad.apply(ap,ar.substr(3).split("~"));default:return ar}}for(var ai=0;ai<ao.length;++ai){switch(ao[ai].toLowerCase()){case"b":case"(":case"beginpath":this.beginPath();break;case")":case"closepath":this.closePath();break;case"m":case"moveto":this.moveTo(+ao[++ai],+ao[++ai]);break;case"l":case"lineto":this.lineTo(+ao[++ai],+ao[++ai]);break;case"q":case"quadraticcurveto":this.quadraticCurveTo(+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai]);break;case"c":case"beziercurveto":this.bezierCurveTo(+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai]);break;case"a":case"arc":this.arc(+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai]);break;case"aa":case"antiarc":this.arc(+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai],true);break;case"arcto":this.arcTo(+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai]);break;case"o":case"circle":this.arc(+ao[++ai],+ao[++ai],+ao[++ai],0,2*Math.PI);break;case"rr":case"roundedrect":var am=+ao[++ai],al=+ao[++ai],an=+ao[++ai],aj=+ao[++ai],ag=+ao[++ai];this.beginPath();this.moveTo(am+ag,al);this.arcTo(am+an,al,am+an,al+aj,ag);this.arcTo(am+an,al+aj,am,al+aj,ag);this.arcTo(am,al+aj,am,al,ag);this.arcTo(am,al,am+an,al,ag);this.closePath();break;case"t":case"translate":this.translate(+ao[++ai],+ao[++ai]);break;case"r":case"rotate":this.rotate(+ao[++ai]);break;case"z":case"scale":this.scale(+ao[++ai],+ao[++ai]);break;case"zx":case"xscale":this.scale(+ao[++ai],1);break;case"zy":case"yscale":this.scale(1,+ao[++ai]);break;case"hflip":this.scale(-1,1);break;case"vflip":this.scale(1,-1);break;case"x":case"transform":this.transform(+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai]);break;case"xshear":this.transform(1,0,+ao[++ai],1,0,0);break;case"yshear":this.transform(1,+ao[++ai],0,1,0,0);break;case"f":case"fill":this.fill();break;case"s":case"stroke":this.stroke();break;case"fr":case"fillrect":this.fillRect(+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai]);break;case"sr":case"strokerect":this.strokeRect(+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai]);break;case"fsr":case"fillstrokerect":var am=+ao[++ai],al=+ao[++ai],an=+ao[++ai],aj=+ao[++ai];this.fillRect(am,al,an,aj);this.strokeRect(am,al,an,aj);break;case"cr":case"clearrect":this.clearRect(+ao[++ai],+ao[++ai],+ao[++ai],+ao[++ai]);break;case"f0":case"fillall":this.fillRect(0,0,this.canvas.width,this.canvas.height);break;case"c0":case"clearall":this.clearRect(0,0,this.canvas.width,this.canvas.height);break;case"tr":case"tracerect":var am=+ao[++ai],al=+ao[++ai],an=+ao[++ai],aj=+ao[++ai];this.beginPath();this.moveTo(am,al);this.lineTo(am+an,al);this.lineTo(am+an,al+aj);this.lineTo(am,al+aj);this.closePath();break;case"fs":case"fillstyle":this.fillStyle=ah(ao[++ai]);break;case"ss":case"strokestyle":this.strokeStyle=ah(ao[++ai]);break;case"shadowblur":case"shb":this.shadowBlur=+ao[++ai];break;case"shadowcolor":case"shc":this.shadowColor=ah(ao[++ai]);break;case"shadowoffsetx":case"shadowx":case"shx":this.shadowOffsetX=+ao[++ai];break;case"shadowoffsety":case"shadowy":case"shy":this.shadowOffsetY=+ao[++ai];break;case"shadowoffsetxy":case"shadowxy":case"shxy":this.shadowOffsetX=+ao[++ai];this.shadowOffsetY=+ao[++ai];break;case"shadow":case"sh":this.shadowColor=ah(ao[++ai]);this.shadowOffsetX=+ao[++ai];this.shadowOffsetY=+ao[++ai];this.shadowBlur=+ao[++ai];break;case"drawimage":this.drawImage(ao[++ai],+ao[++ai],+ao[++ai]);break;case"drawimage0":this.drawImage(ao[++ai],0,0);break;case"clip":this.clip();break;case"al":case"alpha":case"globalalpha":this.globalAlpha=+ao[++ai];break;case"lw":case"linewidth":this.lineWidth=+ao[++ai];break;case"lc":case"linecap":this.lineCap=ao[++ai];break;case"textalign":this.textAlign=ao[++ai];break;case"textbaseline":this.textBaseline=ao[++ai];break;case"[":case"save":this.save();break;case"]":case"restore":this.restore();break;case"font":this.font=ao[++ai].replace(/~/g," ");break;case"filltext":case"ft":this.fillText(ao[++ai].replace(/~/g," "),+ao[++ai],+ao[++ai]);break;case"filltext0":case"ft0":this.fillText(ao[++ai].replace(/~/g," "),0,0);break;case"stroketext":case"st":this.strokeText(ao[++ai].replace(/~/g," "),+ao[++ai],+ao[++ai]);break;case"stroketext0":case"st0":this.strokeText(ao[++ai].replace(/~/g," "),0,0);break;case"fillstroketext":case"fst":var aq=ao[++ai].replace(/~/g," "),am=+ao[++ai],al=+ao[++ai];this.fillText(aq,am,al);this.strokeText(aq,am,al);break;case"fillstroketext0":case"fst0":var aq=ao[++ai].replace(/~/g," ");this.fillText(aq,0,0);this.strokeText(aq,0,0);break;default:throw"Unrecognized draw token "+ao[ai]}}};t._draw.circle=function(ah,al,aj,ag,ai,ak){this.save();this.beginPath();this.arc(ah,al,aj,0,2*Math.PI);if(ag){this.fillStyle=ag;this.fill()}if(ai||ak){if(ai){this.strokeStyle=ai}if(ak){this.lineWidth=ak}this.stroke()}this.restore()};t._draw.lingrad=function(ai,ak,ah,aj){var al=this.createLinearGradient(+ai,+ak,+ah,+aj);for(var ag=4;ag<arguments.length;ag+=2){al.addColorStop(+arguments[ag],arguments[ag+1])}return al};t._draw.radgrad=function(ak,am,aj,ai,al,ag){var an=this.createRadialGradient(+ak,+am,+aj,+ai,+al,+ag);for(var ah=6;ah<arguments.length;ah+=2){an.addColorStop(+arguments[ah],arguments[ah+1])}return an};t.draw=function(ag){if(ag.beginPath){return t._draw.apply(ag,Array.prototype.slice.call(arguments,1))}else{if(t.draw._context){return t._draw.apply(t.draw._context,arguments)}else{throw"UFX.draw must be called with context as first argument"}}};for(var y in t._draw){t.draw[y]=(function(ah,ag){return function(ai){if(ai.beginPath){return ah.apply(ai,Array.prototype.slice.call(arguments,1))}else{if(!t.draw._context){t.draw._context=document.createElement("canvas").getContext("2d")}return ah.apply(t.draw._context,arguments)}}})(t._draw[y],y)}t.draw.setcontext=function(ag){t.draw._context=ag};t.draw.extend=function(ag){ag.draw=function(){t._draw.apply(ag,arguments)};for(var ah in t._draw){ag.draw[ah]=(function(ai){return function(){return ai.apply(ag,arguments)}})(t._draw[ah])}};"use strict";var t=t||{};t.maximize={resizemode:"fixed",preventscroll:true,fillcolor:"black",onadjust:null,init:function(ag){this.element=ag;this.mode=null;function ah(ai,aj){return function(){ai[aj]()}}this.calladjust=ah(this,"adjust");this.getsettings()},setmode:function(ag){if(this.mode==ag){return}if(this.mode=="fill"){window.removeEventListener("resize",this.calladjust)}if(this.mode=="full"){document.cancelFullscreen();window.removeEventListener("resize",this.calladjust)}this.mode=ag;if(this.mode=="fill"){window.addEventListener("resize",this.calladjust)}if(this.mode=="full"){this.element.requestFullscreen();window.addEventListener("resize",this.calladjust)}},adjust:function(){var ah=window.innerWidth,ag=window.innerHeight;var ak=this.element.width,ai=this.element.height;var aq,ap,ao,an;if(this.resizemode=="none"){}else{if(this.resizemode=="fixed"){if(ak*ag>ai*ah){aq=ah;ap=Math.round(ah*ai/ak)}else{aq=Math.round(ag*ak/ai);ap=ag}}else{if(this.resizemode=="aspect"){if(ak*ag>ai*ah){ao=aq=ah;an=ap=Math.round(ah*ai/ak)}else{ao=aq=Math.round(ag*ak/ai);an=ap=ag}}else{if(this.resizemode=="total"){ao=aq=ah;an=ap=ag}}}}var am=this.element.style;if(aq){am.width=aq+"px";am.height=ap+"px"}if(ao){this.element.width=ao;this.element.height=an}if(this.mode=="fill"){var al=ah-(aq||ao||this.element.width);var aj=ag-(ap||an||this.element.height);am.borderLeft=am.borderRight=al>0?(0.5*al+1)+"px "+this.fillcolor+" solid":"none";am.borderTop=am.borderBottom=aj>0?(0.5*aj+1)+"px "+this.fillcolor+" solid":"none";setTimeout(function(){window.scrollTo(0,1)},1)}else{if(this.mode=="full"){am.borderLeft=am.borderRight="none";am.borderTop=am.borderBottom="none"}}if(this.onadjust){this.onadjust(this.element,this.element.width,this.element.height)}},fill:function(ah,ag){if(ag){this.resizemode=ag}if(ah){this.init(ah)}this.setmode("fill");if(this.preventscroll){document.body.addEventListener("touchstart",this.preventdefault);this.scrollprevented=true}this.adjust();var ai=this.element.style;ai.position="absolute";ai.left="0px";ai.top="1px";document.body.style.overflow="hidden"},full:function(ai,ah){if(ah){this.resizemode=ah}if(ai){this.init(ai)}this.setmode("full");var ag=this;setTimeout(function(){if(ag.getfullscreenelement()===ag.element){ag.adjust()}else{ag.restore()}},100)},maximize:function(ai,ah){if(ah){this.resizemode=ah}if(ai){this.init(ai)}if(!this.element.requestFullscreen){this.fill();return}this.setmode("full");var ag=this;setTimeout(function(){if(ag.getfullscreenelement()===ag.element){}else{ag.fill()}},100)},getfullscreenelement:function(){return document.getFullscreenElement},restore:function(){this.setmode();if(this.scrollprevented){document.body.removeEventListener("touchstart",this.preventdefault);this.scrollprevented=false}this.restoresettings();if(this.onadjust){this.onadjust(this.element,this.element.width,this.element.height)}},getsettings:function(){var ai=this.element.style,ag=this.settings={width:this.element.width,height:this.element.height,overflow:document.body.style.overflow,style:{}};var ah="width height position left top borderLeft borderRight borderTop borderBottom border".split(" ");ah.forEach(function(aj){ag.style[aj]=ai[aj]})},restoresettings:function(){var ai=this.element.style,ag=this.settings;width:this.element.width=this.settings.width;height:this.element.height=this.settings.height;overflow:document.body.style.overflow=this.settings.overflow;var ah="width height position left top borderLeft borderRight borderTop borderBottom border".split(" ");ah.forEach(function(aj){ai[aj]=ag.style[aj]})},fillnoresize:function(){es.position="absolute";es.left="0px";es.top="1px";this.setbordersizes(wx-px,wy-py);document.body.style.overflow="hidden"},preventdefault:function(ag){ag.preventDefault()}};"use strict";var t=t||{};t.key={};t.key.active=true;t.key.capture=true;t.key.qdown=true;t.key.qup=true;t.key.qcombo=false;t.key.combodt=100;t.key.watchlist=null;t.key.ispressed={};t.key.codepressed={};t.key.events=function(){var ag=t.key._downevents.concat(t.key._upevents);t.key.clearevents();return ag};t.key.combos=function(){t.key._checkcombo();var ag=t.key._combos;t.key.clearcombos();return ag};t.key.clearevents=function(){t.key._downevents=[];t.key._upevents=[]};t.key.clearcombos=function(ag){t.key._combos=[];if(ag){t.key._currentcombo=null}};t.key.state=function(){var ah={pressed:{}};for(var ag in t.key.ispressed){if(t.key.ispressed[ag]){ah.pressed[ag]=1}}if(t.key.qdown){ah.down={}}if(t.key.qup){ah.up={}}t.key.events().forEach(function(ai){ah[ai.type][ai.name]=1});if(t.key.qcombo){ah.combo={};t.key.combos().forEach(function(ai){ah.combo[ai.kstring]=1})}return ah};t.key.init=function(ag){t.key._captureevents(ag)};t.key.map={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"caps",27:"esc",32:"space",33:"pgup",34:"pgdn",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:"semicolon",61:"equals",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"np0",97:"np1",98:"np2",99:"np3",100:"np4",101:"np5",102:"np6",103:"np7",104:"np8",105:"np9",106:"star",107:"plus",109:"hyphen",110:"period",111:"slash",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"num",188:"comma",190:"period",191:"slash",192:"backtick",219:"openbracket",220:"backslash",221:"closebracket",222:"apostrophe"};t.key.remap=function(){for(var ai=0;ai<arguments.length;++ai){var ak=arguments[ai];for(var ah in ak){var ag=ak[ah];for(var aj in t.key.map){if(t.key.map[aj]===ah){t.key.map[aj]=ag}}}}};t.key.remaparrows=function(ag){t.key.remap({A:"left",S:"down",D:"right",W:"up"});if(ag){t.key.remap({O:"down",comma:"up",",":"up",E:"right"})}};t.key.remappunct=function(){t.key.remap({semicolon:";",equals:"=",star:"*",plus:"+",hyphen:"-",period:".",slash:"/",comma:",",backtick:"`",openbracket:"[",backslash:"\\",closebracket:"]",apostrophe:"'"})};t.key._downevents=[];t.key._upevents=[];t.key._combos=[];t.key._currentcombo=null;t.key._captureevents=function(ag){ag=ag||document;if(typeof ag=="String"){ag=document.getElementById(ag)}ag.addEventListener("blur",t.key._onblur,true);window.onblur=t.key._onblur;ag.onkeypress=t.key._onkeypress;ag.onkeyup=t.key._onkeyup;ag.onkeydown=t.key._onkeydown;t.key._element=ag};t.key._onblur=function(ah){for(var ag in t.key.codepressed){t.key._storeup(ah,ag)}return true};t.key._watching=function(ag){if(!t.key.watchlist){return true}return t.key.watchlist.indexOf(t.key.map[ag.which])>-1};t.key._onkeypress=function(ag){if(!t.key.active||!t.key._watching(ag)){return true}return !t.key.capture};t.key._onkeydown=function(ah){if(!t.key.active||!t.key._watching(ah)){return true}var ag=ah.which;if(t.key.codepressed[ag]){return !t.key.capture}t.key._storedown(ah,ag);return !t.key.capture};t.key._onkeyup=function(ag){if(!t.key.active||!t.key._watching(ag)){return true}t.key._storeup(ag,ag.which);return !t.key.capture};t.key._storedown=function(aj,ai){ai=ai||aj.which;var ah=(new Date()).getTime();var ak=t.key.map[ai]||"key#"+ai;var ag={baseevent:aj,type:"down",code:ai,name:ak,time:ah};t.key.codepressed[ai]=ag;if(ag.name){t.key.ispressed[ag.name]=ag}if(t.key.qdown){t.key._downevents.push(ag)}if(t.key.qcombo){t.key._checkcombo();if(t.key._currentcombo){t.key._currentcombo.keys.push(ak)}else{t.key._currentcombo={start:ah,keys:[ak]}}}};t.key._storeup=function(aj,ai){var ak=(new Date()).getTime();var ah=t.key.codepressed[ai]?ak-t.key.codepressed[ai].time:0;var ag={type:"up",baseevent:aj,code:ai,name:t.key.map[ai]||"key#"+ai,time:ak,dt:ah};delete t.key.codepressed[ai];if(ag.name){delete t.key.ispressed[ag.name]}if(t.key.qup){t.key._upevents.push(ag)}};t.key._checkcombo=function(){if(!t.key._currentcombo){return}var ag=(new Date()).getTime();if(t.key._currentcombo.start+t.key.combodt<ag){var ah=t.key._currentcombo.keys;ah.sort();t.key._combos.push({keys:ah,kstring:ah.join(" "),time:t.key._currentcombo.start});t.key._currentcombo=null}};"use strict";var t=t||{};t.ticker={defaultopts:{sync:"auto",cthis:null,delay:0,minupf:1,maxupf:1,ups:null,minups:null,maxups:null,fps:30,cfac:null},init:function(ai,ah,ag){this.setcallbacks(ai,ah);this.setoptions(ag);this.resume()},setcallbacks:function(ah,ag){this._tcallback=ah;this._dcallback=ag},setoptions:function(ag,ai){if(!ai){for(var ah in this.defaultopts){this[ah]=this.defaultopts[ah]}}if(!ag){return}for(var ah in this.defaultopts){if(ah in ag){this[ah]=ag[ah]}}},resume:function(){this.stop();this.resetcounters();this._running=true;this._tick()},stop:function(){if(this._shandle){window.cancelAnimationFrame(this._shandle)}if(this._thandle){clearTimeout(this._thandle)}this._shandle=this._thandle=null;this._running=false},resetcounters:function(){this._accumulator=0;this._dtu=0;this._dtg=0;this._dtf=0;this._lastthink=Date.now();this._lastdraw=Date.now();this.wfactor=1},getrates:function(){return[this.wfps.toPrecision(3)+"fps",this.wups.toPrecision(3)+"ups",this.wfactor.toPrecision(3)+"x"].join(" ")},_tick:function(){if(!this._running){return}var aj=Date.now();var av=this._lasttick?(aj-this._lasttick)*0.001:0;this._lasttick=aj;this._accumulator+=av;var ai=this.fps;var am=this.minupf;var au=this.maxupf;var az=this.minups||this.ups||ai;var ap=this.maxups||this.ups||az;var ah=this.cfac||1/az;var ak,aw,aq,at;if(am==0){ak=true}else{ak=this._accumulator>=am/ap}if(!ak){aw=0;at=am/ap}else{if(am>=au){aw=am;at=aq=Math.min(this._accumulator,am/az)}else{var ar=Math.floor(this._accumulator*az);if((ar+1)/ap<=this._accumulator){ar+=1}aw=Math.max(Math.min(ar,au),am);aq=Math.min(aw/az,this._accumulator);at=Math.max(am,1)/ap}}if(aw){this._accumulator-=aq;aj=Date.now();this._dtu=(1-ah*aw)*this._dtu+ah*0.001*(aj-this._lastthink);this._dtg=(1-ah*aw)*this._dtg+ah*aq;this._lastthink=aj;aq/=aw;for(var ao=0;ao<aw;++ao){this._tcallback.call(this.cthis,aq,ao,aw)}}if(ak&&this._dcallback){var ax=this._accumulator*az;this._dcallback.call(this.cthis,ax);aj=Date.now();this._dtf=(1-ah)*this._dtf+ah*0.001*(aj-this._lastdraw);this._lastdraw=aj}this._accumulator=Math.max(Math.min(this._accumulator,at),0);this.wups=1/this._dtu;this.wfps=this._dcallback?1/this._dtf:this.wups;this.wfactor=this._dtg/this._dtu;if(!this._running){return}var al=this.sync=="auto"?window.requestAnimationFrame:this.sync;this._shandle=this._thandle=null;var an=(function(aA){return function(){aA._tick()}})(this);if(al){this._shandle=window.requestAnimationFrame(an)}else{var ag=this._lasttick+1000*(at-this._accumulator);var ay=Math.max(Math.ceil(ag-Date.now()),this.delay);this._thandle=window.setTimeout(an,ay)}}};"use strict";var t=t||{};t.SceneStack=function(){if(!(this instanceof t.SceneStack)){return new t.SceneStack()}this._actionq=[];this._stack=[];this.resolveargs=true;this.recorder=null;this.frozen=false};t.SceneStack.prototype={init:function(ag,ah){ag=Object.create(ag||null);ag.cthis=this;t.ticker.init(this.think,this.draw,ag,ah)},top:function(){var ag=this._stack.length;return ag?this._stack[ag-1]:null},getscene:function(ag){if(typeof ag==="string"){if(ag.substr(0,4)=="new_"){ag=ag.substr(4);if(!(ag in t.scenes)){throw"Unrecognized scene: "+ag}return new t.scenes[ag]()}else{if(ag.substr(0,7)=="create_"){ag=ag.substr(7);if(!(ag in t.scenes)){throw"Unrecognized scene: "+ag}return Object.create(t.scenes[ag])}}if(!(ag in t.scenes)){throw"Unrecognized scene: "+ag}return t.scenes[ag]}return ag},ipush:function(ai){if(this.frozen){return}var ag=this.top();if(ag&&ag.suspend){ag.suspend()}var aj=this.getscene(ai);this._stack.push(aj);var ah=Array.prototype.slice.call(arguments,1);if(this.resolveargs&&aj.startargs){ah=aj.startargs.apply(aj,ah)}if(this.recorder){this.recorder.addpush(ai,ah)}if(aj.checkpoint&&this.recorder){this.recorder.checkpoint(aj.getchaptername?aj.getchaptername.apply(aj,ah):ai)}if(aj.start){aj.start.apply(aj,ah)}},ipop:function(aj){if(this.frozen){return}aj=aj||1;for(var ag=0;ag<aj;++ag){var ai=this._stack.pop();if(ai.stop){ai.stop()}var ah=this.top();if(ah&&ah.resume){ah.resume()}if(this.recorder){this.recorder.addpop()}}return ai},iswap:function(ah){if(this.frozen){return}var ai=this._stack.pop();if(ai&&ai.stop){ai.stop()}var aj=this.getscene(ah);this._stack.push(aj);var ag=Array.prototype.slice.call(arguments,1);if(this.resolveargs&&aj.startargs){ag=aj.startargs.apply(aj,ag)}if(this.recorder){this.recorder.addswap(ah,ag)}if(aj.checkpoint&&this.recorder){this.recorder.checkpoint(aj.getchaptername?aj.getchaptername.apply(aj,ag):ah)}if(aj.start){aj.start.apply(aj,ag)}return ai},push:function(){this._actionq.push(["push",Array.prototype.slice.call(arguments,0)])},pop:function(){this._actionq.push(["pop",Array.prototype.slice.call(arguments,0)])},swap:function(){this._actionq.push(["swap",Array.prototype.slice.call(arguments,0)])},_resolveq:function(){for(var ag=0;ag<this._actionq.length;++ag){switch(this._actionq[ag][0]){case"push":this.ipush.apply(this,this._actionq[ag][1]);break;case"pop":this.ipop.apply(this,this._actionq[ag][1]);break;case"swap":this.iswap.apply(this,this._actionq[ag][1]);break}}this._actionq=[]},think:function(){this._resolveq();var ah=this.top();this._lastthinker=ah;if(ah){var ag=arguments;if(this.resolveargs&&ah.thinkargs){ag=ah.thinkargs.apply(ah,ag)}if(this.recorder){this.recorder.addthink(ag)}if(ah.think){ah.think.apply(ah,ag)}}},draw:function(){var ag=this._lastthinker;if(ag&&ag.draw){ag.draw.apply(ag,arguments)}}};t.scene=new t.SceneStack();t.scenes={};"use strict";var t=t||{};t.random=function(ah,ag){if(typeof ag=="undefined"){ag=ah;ah=0;if(typeof ag=="undefined"){ag=1}}return t.random.rand()*(ag-ah)/4294967296+ah};t.random.rand=function(ag,ah){if(typeof ah!="undefined"){return ag+t.random.rand(ah-ag)}if(typeof t.random.seed=="undefined"){t.random.setseed()}t.random.seed=(1664525*t.random.seed+1013904223)%4294967296;return ag?Math.floor(t.random.seed*ag/4294967296):t.random.seed};t.random.hash=function(aj){var ai=typeof aj=="string"?aj:JSON.stringify(aj),ak=ai.length,ah=0;for(var ag=0;ag<ak;++ag){ah+=ai.charCodeAt(ag);ah+=ah<<10;ah^=ah>>>6}ah+=ah<<3;ah^=ah>>>11;ah+=ah<<15;if(ah<0){ah+=4294967296}return ah};t.random.setseed=function(ag){if(typeof ag=="undefined"){ag=Math.floor(Math.random()*4294967296)}else{if(typeof ag=="number"){ag=Math.floor(ag)%4294967296}else{ag=t.random.hash(ag)}}t.random.seed=ag;delete t.random.normal._y;return ag};t.random._seedstack=[];t.random.pushseed=function(ag){if(typeof t.random.seed=="undefined"){t.random.setseed()}t.random._seedstack.push(t.random.seed);t.random.setseed(ag);return t.random.seed};t.random.popseed=function(){t.random.seed=t.random._seedstack.pop();return t.random.seed};t.random.choice=function(ah,ag){return ag?ah.splice(t.random.rand(ah.length),1)[0]:ah[t.random.rand(ah.length)]};t.random.word=function(aj,ai){var ag=[];aj=aj||8;ai=ai||"abcdefghijklmnopqrstuvwxyz";for(var ah=0;ah<aj;++ah){ag.push(t.random.choice(ai))}return ag.join("")};t.random.color=function(){return"#"+t.random.word(6,"0123456789ABCDEF")};t.random.shuffle=function(ag){for(var aj=ag.length-1;aj>0;--aj){var ai=t.random.rand(aj+1);var ah=ag[aj];ag[aj]=ag[ai];ag[ai]=ah}return ag};t.random.rdisk=function(){var ag,ah;do{ag=t.random(-1,1);ah=t.random(-1,1)}while(ag*ag+ah*ah>1);return[ag,ah]};t.random.rsphere=function(){var ag,aj,ai;do{ag=t.random(-1,1);aj=t.random(-1,1);ai=t.random(-1,1)}while(ag*ag+aj*aj+ai*ai>1);var ah=Math.sqrt(ag*ag+aj*aj+ai*ai);if(ah===0){return[0,0,1]}return[ag/ah,aj/ah,ai/ah]};t.random.spread=function(ak,ai,an,am,aj,ar){ak=ak||100;ai=ai||0.15;an=an||1;am=am||an;aj=aj||0;ar=ar||aj;var ah=[],ao=1;while(ah.length<ak){var aq=t.random(),ap=t.random(),ag=true;for(var al=0;al<ah.length;++al){var au=Math.abs(aq-ah[al][0]),at=Math.abs(ap-ah[al][1]);if(au>0.5){au=1-au}if(at>0.5){at=1-at}if(au*au+at*at<ao){ag=false;break}}if(ag){ah.push([aq,ap]);ao=ai/ah.length}else{ao*=0.9}}for(var al=0;al<ak;++al){ah[al][0]=aj+ah[al][0]*an;ah[al][1]=ar+ah[al][1]*am}return ah};t.random.spread1d=function(an,aj){an=an||100;aj=aj||0.15;var am=[],ah=1;while(am.length<an){var ag=t.random(),al=true;for(var ak=0;ak<am.length;++ak){var ai=Math.abs(ag-am[ak]);if(ai>0.5){ai=1-ai}if(ai<ah){al=false;break}}if(al){am.push(ag);ah=0.5*aj/am.length}else{ah*=0.95}}return am};t.random.normal=function(ai,ak){ai=ai||0;ak=ak||1;if(typeof t.random.normal._y=="number"){var ag=t.random.normal._y;delete t.random.normal._y}else{var ag,al,ah;do{ag=t.random(-1,1);al=t.random(-1,1);ah=ag*ag+al*al}while(ah>1);try{ah=Math.sqrt(-2*Math.log(ah)/ah);ag*=ah;al*=ah}catch(aj){ag=al=0}t.random.normal._y=al}return ag*ak+ai};"use strict";var t=t||{};t.noise=function(ai,ao){var aj=ai.length;var ah=new Array(aj);var ap=new Array(aj);for(var al=0;al<aj;++al){var ar=ao?ao[al]:256;var am=Math.floor(ai[al])%ar;if(am<0){am+=ar}ah[al]=[am,(am+1)%ar];ap[al]=ai[al]-Math.floor(ai[al])}var ag=0;for(var ak=0,aq=1<<aj;ak<aq;++ak){var at=new Array(aj);for(var al=0;al<aj;++al){at[al]=ah[al][(ak>>al)&1]}var au=0,aw=1;for(var al=0;al<aj;++al){var an=t.noise._gvalue(at,al);var av=((ak>>al)&1)?1-ap[al]:-ap[al];au+=an*av;aw*=1-av*av*(3-2*Math.abs(av))}ag+=au*aw}return ag/1000/Math.sqrt(aj)};t.noise.wrap2d=function(aS,aN,aY,aX){var at=aS[0],ar=aS[1],ao=at*ar;var aJ=new Array(ao);var aD=new Array(at),aC=new Array(at);var ai=new Array(at),aR=new Array(at),aM=new Array(at),az=new Array(at);aN=aN||[8,8];var aV=aN[0],aU=aN[1],aW=aV*aU;aX=aX||[0,0];var aF=new Array(aW),aE=new Array(aW);for(var aj=0,aw=0;aj<aU;++aj){for(var ak=0;ak<aV;++ak,++aw){aF[aw]=t.noise._gvalue([ak+aX[0],aj+aX[1]],0);aE[aw]=t.noise._gvalue([ak+aX[0],aj+aX[1]],1)}}aY=aY||[0,0];for(var aq=0;aq<at;++aq){var aQ=(aq+0.5)*aV/at+aY[0];aD[aq]=Math.floor(aQ)%aV;if(aD[aq]<0){aD[aq]+=aV}aC[aq]=(aD[aq]+1)%aV;var aH=aQ-Math.floor(aQ),aB=1-aH;ai[aq]=aH;aR[aq]=aB;aM[aq]=aH*aH*(3-2*aH);az[aq]=1-aM[aq]}for(var ap=0,aA=0;ap<ar;++ap){var aP=(ap+0.5)*aU/ar+aY[1];var aG=Math.floor(aP)%aU;if(aG<0){aG+=aU}var am=(aG+1)%aU;var an=aP-Math.floor(aP),ah=1-an;var aT=an*an*(3-2*an),aO=1-aT;for(var aq=0;aq<at;++aq,++aA){var aL=aD[aq],ay=aC[aq];var aH=ai[aq],aB=aR[aq],al=aM[aq],ag=az[aq];var aK=aL+aG*aV,aI=aL+am*aV;var av=ay+aG*aV,au=ay+am*aV;aJ[aA]=((-aH*aF[aK]-an*aE[aK])*aO+(-aH*aF[aI]+ah*aE[aI])*aT)*ag+((aB*aF[av]-an*aE[av])*aO+(aB*aF[au]+ah*aE[au])*aT)*al;aJ[aA]/=1414.213}}return aJ};t.noise.wrapslice=function(a1,a8,aT,bb,ba){var aw=a1[0],au=a1[1],aq=aw*au;var aO=new Array(aq);var aI=new Array(aw),aH=new Array(aw);var aj=new Array(aw),aZ=new Array(aw),aS=new Array(aw),aE=new Array(aw);aT=aT||[8,8,256];if(aT.length==2){aT=[aT[0],aT[1],256]}var a5=aT[0],a4=aT[1],a3=aT[2],a6=a5*a4;ba=ba||[0,0];var a0=Math.floor(a8)%a3;if(a0<0){a0+=a3}var aY=(a0+1)%a3;var ai=a8-Math.floor(a8),aX=1-ai;var aQ=ai*ai*(3-2*ai),aC=1-aQ;var aM=new Array(a6),av=new Array(a6),a9=new Array(a6);var aL=new Array(a6),at=new Array(a6),a7=new Array(a6);for(var ak=0,aB=0;ak<a4;++ak){for(var al=0;al<a5;++al,++aB){aM[aB]=t.noise._gvalue([al+ba[0],ak+ba[1],a0],0);av[aB]=t.noise._gvalue([al+ba[0],ak+ba[1],a0],1);a9[aB]=t.noise._gvalue([al+ba[0],ak+ba[1],a0],2);aL[aB]=t.noise._gvalue([al+ba[0],ak+ba[1],aY],0);at[aB]=t.noise._gvalue([al+ba[0],ak+ba[1],aY],1);a7[aB]=t.noise._gvalue([al+ba[0],ak+ba[1],aY],2)}}bb=bb||[0,0];for(var ar=0;ar<aw;++ar){var aW=(ar+0.5)*a5/aw+bb[0];aI[ar]=Math.floor(aW)%a5;if(aI[ar]<0){aI[ar]+=a5}aH[ar]=(aI[ar]+1)%a5;var aK=aW-Math.floor(aW),aG=1-aK;aj[ar]=aK;aZ[ar]=aG;aS[ar]=aK*aK*(3-2*aK);aE[ar]=1-aS[ar]}for(var ap=0,aF=0;ap<au;++ap){var aV=(ap+0.5)*a4/au+bb[1];var aJ=Math.floor(aV)%a4;if(aJ<0){aJ+=a4}var ao=(aJ+1)%a4;var an=aV-Math.floor(aV),ah=1-an;var a2=an*an*(3-2*an),aU=1-a2;for(var ar=0;ar<aw;++ar,++aF){var aR=aI[ar],aD=aH[ar];var aK=aj[ar],aG=aZ[ar],am=aS[ar],ag=aE[ar];var aP=aR+aJ*a5,aN=aR+ao*a5;var aA=aD+aJ*a5,ay=aD+ao*a5;aO[aF]=(((-aK*aM[aP]-an*av[aP]-ai*a9[aP])*aU+(-aK*aM[aN]+ah*av[aN]-ai*a9[aN])*a2)*ag+((aG*aM[aA]-an*av[aA]-ai*a9[aA])*aU+(aG*aM[ay]+ah*av[ay]-ai*a9[ay])*a2)*am)*aC+(((-aK*aL[aP]-an*at[aP]+aX*a7[aP])*aU+(-aK*aL[aN]+ah*at[aN]+aX*a7[aN])*a2)*ag+((aG*aL[aA]-an*at[aA]+aX*a7[aA])*aU+(aG*aL[ay]+ah*at[ay]+aX*a7[ay])*a2)*am)*aQ;aO[aF]/=1732.051}}return aO};t.noise.fractalize=function(au,ax,aw){var ar=ax[0],an=ax[1];var ah=ar/2,ao=an/2,at=ah*ao;if(ah<2||ao<2){return}var aq=new Array(ah*ao);for(var am=0,aj=0;am<an;am+=2){var ak=am*ar;for(var ap=0;ap<ar;ap+=2,++aj){aq[aj]=au[ak+ap]}}if(aw!==1){t.noise.fractalize(aq,[ah,ao],(typeof aw=="number"?aw-1:aw))}for(var aj=0;aj<at;++aj){aq[aj]*=0.5}for(var al=0,av=0;al<ao;++al){for(var ag=0;ag<ah;++ag,++av){var ai=aq[av];au[al*ar+ag]+=ai;au[al*ar+ag+ah]+=ai;au[(al+ao)*ar+ag]+=ai;au[(al+ao)*ar+ag+ah]+=ai}}};t.noise._grad=[-2885,-2520,-2335,-2206,-2106,-2024,-1953,-1891,-1835,-1785,-1739,-1696,-1656,-1618,-1583,-1550,-1518,-1488,-1459,-1431,-1404,-1378,-1353,-1329,-1306,-1283,-1261,-1240,-1219,-1199,-1179,-1159,-1140,-1122,-1104,-1086,-1068,-1051,-1034,-1018,-1001,-985,-970,-954,-939,-924,-909,-894,-879,-865,-851,-837,-823,-809,-796,-783,-769,-756,-743,-730,-718,-705,-693,-680,-668,-656,-644,-632,-620,-608,-596,-584,-573,-561,-550,-539,-527,-516,-505,-494,-483,-472,-461,-450,-439,-428,-418,-407,-396,-386,-375,-365,-354,-344,-334,-323,-313,-303,-292,-282,-272,-262,-252,-242,-232,-222,-212,-202,-192,-182,-172,-162,-152,-142,-132,-122,-112,-102,-93,-83,-73,-63,-53,-44,-34,-24,-14,-4,4,14,24,34,44,53,63,73,83,93,102,112,122,132,142,152,162,172,182,192,202,212,222,232,242,252,262,272,282,292,303,313,323,334,344,354,365,375,386,396,407,418,428,439,450,461,472,483,494,505,516,527,539,550,561,573,584,596,608,620,632,644,656,668,680,693,705,718,730,743,756,769,783,796,809,823,837,851,865,879,894,909,924,939,954,970,985,1001,1018,1034,1051,1068,1086,1104,1122,1140,1159,1179,1199,1219,1240,1261,1283,1306,1329,1353,1378,1404,1431,1459,1488,1518,1550,1583,1618,1656,1696,1739,1785,1835,1891,1953,2024,2106,2206,2335,2520,2885];t.noise._perm=[127,13,214,153,195,181,253,32,17,180,95,9,159,81,209,129,31,157,21,76,118,79,91,0,38,234,8,147,148,227,206,78,22,223,198,109,240,46,115,71,133,175,232,14,168,37,196,49,213,106,62,119,85,61,104,220,139,203,44,73,189,237,39,210,28,57,6,172,164,40,51,186,233,52,204,199,50,243,161,126,249,7,36,244,131,231,24,1,252,142,27,53,188,254,137,184,92,201,136,165,43,145,205,216,33,19,101,75,156,60,228,215,197,185,248,30,26,200,107,96,11,247,173,111,108,235,166,241,105,120,47,110,130,167,112,208,160,154,42,16,48,34,202,221,74,122,236,64,143,246,103,88,222,238,162,155,163,80,230,72,25,176,68,158,121,124,63,177,113,41,3,45,86,55,114,67,134,212,58,242,179,192,35,170,211,15,149,224,140,66,128,219,193,2,229,117,93,54,132,135,218,169,187,207,191,144,138,245,190,65,23,146,123,56,152,194,171,18,4,100,150,255,99,98,183,83,70,97,141,178,182,250,84,10,239,217,94,116,174,29,151,82,12,225,59,125,20,5,69,251,77,102,90,89,226,87];t.noise._gvalue=function(ag,aj){var ai=t.noise._perm[aj];for(var ah=0;ah<ag.length;++ah){ai=t.noise._perm[(ai+ag[ah])&255]}return t.noise._grad[ai]};"use strict";var t=t||{};t.texture={joinobj:function(aj,ai){var ah=Object.create(ai);if(!aj){return ah}for(var ag in aj){ah[ag]=aj[ag]}return ah},reduceargs:function(ah){if(ah.length==0){return{}}var ai=ah[0]||{};for(var ag=1;ag<ah.length;++ag){if(ah[ag]){ai=this.joinobj(ai,ah[ag])}}return ai},makecanvas:function(ag,ai){var ah=document.createElement("canvas");ah.width=ag;ah.height=ai;ah.context=ah.getContext("2d");var aj=ah.context.createImageData(ag,ai);ah.data=aj.data;ah.applydata=function(){ah.context.putImageData(aj,0,0);delete ah.data};return ah},stat:function(){var al=this.reduceargs(arguments);var at=al.width||al.size||256;var am=al.height||al.size||256;var ap=al.rmin||0,av="rmax" in al?al.rmax:256;var an=al.gmin||0,au="gmax" in al?al.gmax:256;var ar=al.bmin||0,ah="bmax" in al?al.bmax:256;var ai=al.wmin||0,aq=al.wmax||0;if(al.seed){t.random.setseed(al.seed)}var ag=this.makecanvas(at,am),ak=ag.data;for(var aj=0;aj<at*am*4;aj+=4){var ao=aq&&t.random.rand(ai,aq);ak[aj]=ao+(av&&t.random.rand(ap,av));ak[aj+1]=ao+(au&&t.random.rand(an,au));ak[aj+2]=ao+(ah&&t.random.rand(ar,ah));ak[aj+3]=255}ag.applydata();return ag},grass:function(){return this.stat(this.reduceargs(arguments),{rmin:20,rmax:60,gmin:100,gmax:140,bmin:0,bmax:20})},deadgrass:function(){return this.stat(this.reduceargs(arguments),{wmin:100,wmax:120,rmin:80,rmax:100,gmin:80,gmax:100,bmin:0,bmax:0})},dirt:function(){return this.stat(this.reduceargs(arguments),{rmin:90,rmax:120,gmin:90,gmax:120,bmin:0,bmax:10})},gravel:function(){return this.stat(this.reduceargs(arguments),{wmin:60,wmax:200,rmin:0,rmax:10,gmin:0,gmax:10,bmin:0,bmax:10})},spots:function(){var au=this.reduceargs(arguments);var ar=au.width||au.size||256;var aA=au.height||au.size||256;var ax=au.rmin||0,ay=au.rmax||256;var ag=au.gmin||0,ah=au.gmax||256;var al=au.bmin||0,an=au.bmax||256;var ap=au.wmin||0,at=au.wmax||0;var av=10000;if(au.seed){t.random.setseed(au.seed)}var aj=document.createElement("canvas");aj.width=ar;aj.height=aA;var ai=aj.getContext("2d");ai.globalAlpha=au.alpha||0.1;for(var az=0;az<av;++az){var am=at&&t.random.rand(ap,at);var aw=am+t.random.rand(ax,ay);var aB=am+t.random.rand(ag,ah);var aC=am+t.random.rand(al,an);var aq=t.random(ar),ao=t.random(aA);var ak=20;ai.fillStyle="rgb("+aw+","+aB+","+aC+")";ai.beginPath();ai.arc(aq,ao,ak,0,2*Math.PI);ai.fill()}return aj},noisedata:function(){var aj=this.reduceargs(arguments);var ap=aj.width||aj.size||256;var al=aj.height||aj.size||256;var ah=aj.xscale||aj.scale||8;var ai=aj.yscale||aj.scale||8;var ao=aj.fraclevel||0;if(aj.seed){t.random.setseed(aj.seed)}var an=256;var am=("xoffset" in aj)?aj.xoffset:t.random(ah);var ag=("yoffset" in aj)?aj.yoffset:t.random(ai);var ak=("zoffset" in aj)?aj.zoffset:t.random(an);var aq=t.noise.wrapslice([ap,al],ak,[ah,ai,an],[am,ag]);if(ao){t.noise.fractalize(aq,[ap,al],ao)}return aq},roughshade:function(){var am=this.reduceargs(arguments);var ak=am.width||am.size||256;var at=am.height||am.size||256;var ap=am.color||[0,0,0];var ao=am.alpha0||100;var av=am.ascale||50;var an=ap[0],au=ap[1],ax=ap[2];var ag=this.makecanvas(ak,at),ay=ag.data;var aw=this.noisedata(am,{scale:64});for(var ah=0,ar=0,aq=0;ah<at;++ah){for(var ai=0;ai<ak;++ai,ar+=4,++aq){var al=aw[ah*ak+(ai+1)%ak]-aw[ah*ak+(ai+ak-1)%ak];var aj=aw[(ah+1)%at*ak+ai]-aw[(ah+at-1)%at*ak+ai];ay[ar]=an;ay[ar+1]=au;ay[ar+2]=ax;ay[ar+3]=ao+av*(2*al+aj)}}ag.applydata();return ag},stone:function(){var ak=this.reduceargs(arguments);var an=ak.width||ak.size||256;var am=ak.height||ak.size||256;var ai=ak.color||[120,120,120];var ag=this.makecanvas(an,am),al=ag.data;var ap=this.noisedata(ak);for(var aj=0,ah=0;ah<an*am;aj+=4,++ah){var ao=150;ao+=Math.max(Math.min(1000*(ap[ah]),30),-30);ao+=Math.max(100-8000*Math.abs(ap[ah]),0);al[aj]=ao*ai[0]/255;al[aj+1]=ao*ai[1]/255;al[aj+2]=ao*ai[2]/255;al[aj+3]=255}ag.applydata();return ag},terrain:function(){var aq=this.reduceargs(arguments);var an=aq.width||aq.size||256;var az=aq.height||aq.size||256;var aD=aq.tgrad||[[-1,0,0,192],[-0.35,0,0,255],[-0.1,0,128,255],[-0.04,240,240,64],[0.08,32,160,0],[0.35,160,160,0],[0.5,128,128,128],[0.7,255,255,255]],ai=aD.length;var ay="sealevel" in aq?aq.sealevel:-0.1;var ar=aq.shadecolor||[0,0,0];var av=ar[0],aG=ar[1],ah=ar[2];var aF=aq.shadex||0,aE=aq.shadey||0;var ax=(aF||aE)&&2*Math.exp(aq.shadefactor||0)/Math.sqrt(aF*aF+aE*aE);var aj=this.makecanvas(an,az),aH=aj.data;var aC=this.noisedata(aq,{fraclevel:3,scale:8});function ag(aK){if(aK<=aD[0][0]){return[aD[0][1],aD[0][2],aD[0][3]]}for(var aL=0;aL<ai-1;++aL){var aJ=aD[aL],aI=aD[aL+1];if(aK>=aJ[0]&&aK<aI[0]){var aN=(aK-aJ[0])/(aI[0]-aJ[0]),aM=1-aN;return[aI[1]*aN+aJ[1]*aM,aI[2]*aN+aJ[2]*aM,aI[3]*aN+aJ[3]*aM]}}return[aD[ai-1][1],aD[ai-1][2],aD[ai-1][3]]}for(var ak=0,aw=0,au=0;ak<az;++ak){for(var al=0;al<an;++al,aw+=4,++au){var ap=aC[au];var at=ag(ap);if(ax&&ap>ay){var ao=aC[ak*an+(al+1)%an]-aC[ak*an+(al+an-1)%an];var am=aC[(ak+1)%az*an+al]-aC[(ak+az-1)%az*an+al];var aB=1+(aF*ao+aE*am)*ax,aA=1-aB;at[0]=aB*at[0]+aA*ax;at[1]=aB*at[1]+aA*ax;at[2]=aB*at[2]+aA*ax}aH[aw]=at[0];aH[aw+1]=at[1];aH[aw+2]=at[2];aH[aw+3]=255}}aj.applydata();return aj},clouds:function(){var an=this.reduceargs(arguments);var am=an.width||an.size||256;var ax=an.height||an.size||256;var at=an.color||[200,200,200];var ap=at[0],ay=at[1],aE=at[2];var ao=an.sharpness||0;var ai=(an.coverage||0.4)-0.5;var aq=an.shadecolor||[0,0,0];var au=aq[0],aH=aq[1],ag=aq[2];var aD=an.shadex||0,aC=an.shadey||0;var aw=(aD||aC)&&0.002*Math.exp(an.shadefactor||0)/Math.sqrt(aD*aD+aC*aC);var aj=4000*Math.exp(ao);var ah=this.makecanvas(am,ax),aI=ah.data;var aA=this.noisedata(an,{fraclevel:2});for(var ak=0,av=0,ar=0;ak<ax;++ak){for(var al=0;al<am;++al,av+=4,++ar){var aF=(aA[ar]+ai)*aj+128;aI[av+3]=aF;if(aw){var aG=(aA[((al+aD)%am)+((ak+aC)%ax)*am]+ai)*aj+128;var az=Math.min(Math.max(aw*(aF-aG),0),1);var aB=1-az;aI[av]=ap*aB+au*az;aI[av+1]=ay*aB+aH*az;aI[av+2]=aE*aB+ag*az}else{aI[av]=ap;aI[av+1]=ay;aI[av+2]=aE}}}ah.applydata();return ah},overcast:function(){var an=this.reduceargs(arguments);var ar=an.width||an.size||256;var ao=an.height||an.size||256;var aj="r0" in an?an.r0:160,ai="dr" in an?an.dr:80;var ag="g0" in an?an.g0:160,ap="dg" in an?an.dg:80;var aq="b0" in an?an.b0:160,av="db" in an?an.db:80;var ah=this.makecanvas(ar,ao),am=ah.data;var au=this.noisedata(an,{fraclevel:2,scale:8});for(var al=0,ak=0;ak<ar*ao;al+=4,++ak){var at=au[ak];am[al]=aj+at*ai;am[al+1]=ag+at*ap;am[al+2]=aq+at*av;am[al+3]=255}ah.applydata();return ah},ocean:function(){return this.overcast(this.reduceargs(arguments),{r0:40,dr:30,g0:40,dg:30,b0:160,db:60})},marble:function(){var aq=this.reduceargs(arguments);var an=aq.width||aq.size||256;var aw=aq.height||aq.size||256;var ak="xfactor" in aq?aq.xfactor:1;var ax="yfactor" in aq?aq.yfactor:2;var ai=(aq.coverage||1.5)-0.5;var ah=3*Math.exp(aq.distortion||0);var ar=Math.min(30*Math.exp(aq.cloudiness||0),250),az=255-ar;var ao=1000*Math.exp(aq.sharpness||0);var aj=this.makecanvas(an,aw),aA=aj.data;var ay=this.noisedata(aq,{fraclevel:3,scale:8});var at=2*Math.PI*ak/an;var ag=2*Math.PI*ax/aw;for(var al=0,av=0,au=0;al<aw;++al){for(var am=0;am<an;++am,av+=4,++au){var ap=ay[au];ap=Math.abs(Math.sin(ah*ap+at*am+ag*al));ap=Math.min(ap*ao,az)+ap*ar;aA[av]=ap;aA[av+1]=ap;aA[av+2]=ap;aA[av+3]=255}}aj.applydata();return aj},nightsky:function(){var ai=this.reduceargs(arguments);var ah=this.overcast(ai,{r0:0,dr:0,g0:0,dg:10,b0:20,db:20});var am=ah.width,aj=ah.height;var an=Math.floor(("density" in ai?ai.density:1)*am*aj/500);var ak="spread" in ai?ai.spread:0.15;var ag="rstar0" in ai?ai.rstar0:0;var ao="rstar1" in ai?ai.rstar1:0.8;var al=ah.context;al.beginPath();t.random.spread(an,ak).forEach(function(aq){var ap=aq[0]*am,ar=aq[1]*aj;al.moveTo(ap,ar);al.arc(ap,ar,t.random(ag,ao),0,2*Math.PI)});al.fillStyle="white";al.fill();return ah},noisestat:function(){var aq=this.reduceargs(arguments);var an=aq.width||aq.size||256;var ay=aq.height||aq.size||256;var au=aq.rmin||0,ax="rmax" in aq?aq.rmax:256;var ag=aq.gmin||0,ah="gmax" in aq?aq.gmax:256;var aj=aq.bmin||0,al="bmax" in aq?aq.bmax:256;var am=aq.wmin||0,ap=aq.wmax||0;var at="dr" in aq?aq.dr:0;var aA="dg" in aq?aq.dg:0;var aB="db" in aq?aq.db:0;var ar="dw" in aq?aq.dw:0;if(aq.seed){t.random.setseed(aq.seed)}var az=this.noisedata(aq);var ai=this.makecanvas(an,ay),aC=ai.data;for(var aw=0,av=0;av<an*ay;aw+=4,++av){var ak=ap&&t.random.rand(am,ap)+ao*ar;var ao=az[av];aC[aw]=ak+(ax&&t.random.rand(au,ax))+ao*at;aC[aw+1]=ak+(ah&&t.random.rand(ag,ah))+ao*aA;aC[aw+2]=ak+(al&&t.random.rand(aj,al))+ao*aB;aC[aw+3]=255}ai.applydata();return ai},patchygrass:function(){return this.noisestat(this.reduceargs(arguments),{wmin:40,wmax:80,dw:-40,rmin:0,rmax:20,dr:-40,gmin:60,gmax:90,dg:40,bmin:0,bmax:10})},patchydirt:function(){return this.noisestat(this.reduceargs(arguments),{wmin:40,wmax:80,dw:-20,rmin:60,rmax:80,dr:60,gmin:20,gmax:40,dg:80,bmin:0,bmax:4})},cement:function(){return this.noisestat(this.reduceargs(arguments),{wmin:120,wmax:160,dw:40,rmin:0,rmax:10,gmin:0,gmax:10,bmin:0,bmax:10})},buffertile:function(al,ak){var ah=ak||20,aj=al.width,an=al.height;var am=document.createElement("canvas");am.width=aj+2*ah;am.height=an+2*ah;am.context=am.getContext("2d");for(var ai=-1;ai<2;++ai){for(var ag=-1;ag<2;++ag){am.context.drawImage(al,ah+aj*ai,ah+an*ag)}}am.drawclip=function(ap,ao,aq){ap.save();ap.translate(ao||0,aq||0);ap.beginPath();ap.moveTo(0,0);ap.lineTo(aj+0.01,0);ap.lineTo(aj+0.01,an+0.01);ap.lineTo(0,an+0.01);ap.closePath();ap.clip();ap.drawImage(am,-ah,-ah);ap.restore()};return am}};t.texture.tiler=function(ah,ag,ai,aj){if(!(this instanceof t.texture.tiler)){return new t.texture.tiler(ah,ag,ai,aj)}this.canvas=ah;this.buffer=ag||2;this.nx=this.ny=0;this.makechart(ai||1,aj||1)};t.texture.tiler.prototype={draw:function(ah,ap,am,ar,al){if(ar===undefined){ar=ap;al=am;ap=0;am=0}var an=this.buffer,ak=this.canvas.width,aj=this.canvas.height;var ai=((ap-an)%ak+ak)%ak+an,ag=ai+ar;var aq=((am-an)%aj+aj)%aj+an,ao=aq+al;this.makechart(Math.floor((ag+an)/ak)+1,Math.floor((ao+an)/aj)+1);ah.save();ah.translate(ap||0,am||0);ah.beginPath();ah.moveTo(0,0);ah.lineTo(ar,0);ah.lineTo(ar,al);ah.lineTo(0,al);ah.closePath();ah.clip();ah.drawImage(this.chart,-ai,-aq);ah.restore()},makechart:function(ag,ak){if(ag<=this.nx&&ak<=this.ny){return}this.nx=Math.max(ag,this.nx);this.ny=Math.max(ak,this.ny);this.chart=document.createElement("canvas");this.chart.width=this.canvas.width*this.nx;this.chart.height=this.canvas.height*this.ny;var aj=this.chart.getContext("2d");for(var ai=0;ai<this.nx;++ai){for(var ah=0;ah<this.ny;++ah){aj.drawImage(this.canvas,ai*this.canvas.width,ah*this.canvas.height)}}}};"use strict";var t=t||{};t.Thing=function(){var ah=Object.create(t.Thing.prototype);for(var ag=0;ag<arguments.length;++ag){ah.addcomp(arguments[ag])}return ah};t.Thing.prototype={_createmethod:function(ai,aj,ag){ag=ag||[];var ah;if(!aj){ah=function(){var al;for(var ak=0;ak<ag.length;++ak){al=ag[ak].apply(this,arguments)}return al}}else{if(aj==="any"){ah=function(){var al;for(var ak=0;ak<ag.length;++ak){al=ag[ak].apply(this,arguments);if(al){return al}}return al}}else{if(aj==="all"){ah=function(){var al;for(var ak=0;ak<ag.length;++ak){al=ag[ak].apply(this,arguments);if(!al){return al}}return al}}else{if(aj==="getarray"){ah=function(){var al=[];for(var ak=0;ak<ag.length;++ak){al.push(ag[ak].apply(this,arguments))}return al}}else{if(aj==="putarray"){ah=function(ak){var am=[];for(var al=0;al<ag.length;++al){am.push(ag[al].apply(this,ak[al]))}return am}}else{}}}}}ah.mlist=ag;return ah},definemethod:function(ag,ah){if(this[ag]){return this}this[ag]=this._createmethod(ag,ah);return this},addcomp:function(ag){if(ag instanceof Array){var aj=ag.slice(0);for(var ah=0;ah<aj.length;++ah){arguments[0]=aj[ah];this.addcomp.apply(this,arguments)}return this}for(var ai in ag){if(ai=="init"||ai=="remove"){continue}if(typeof ag[ai]!="function"){continue}this.definemethod(ai);this[ai].mlist.push(ag[ai])}if(ag.init){ag.init.apply(this,[].slice.call(arguments,1))}return this},removecomp:function(ag){if(ag instanceof Array){var aj=ag.slice(0);for(var ah=0;ah<aj.length;++ah){arguments[0]=aj[ah];this.removecomp.apply(this,arguments)}return this}if(ag.remove){ag.remove.apply(this,[].slice.call(arguments,1))}for(var ai in ag){if(ai=="init"||ai=="remove"){continue}if(!(ai in this)){continue}this[ai].mlist=this[ai].mlist.filter(function(ak){return ak!==ag[ai]})}return this},reversemethods:function(ag){this[ag].mlist.reverse();return this},setmethodmode:function(ag,ah){this[ag]=this._createmethod(ag,ah,(this[ag]?this[ag].mlist:[]));return this},normalize:function(){for(y in this){if(this.hasOwnProperty(y)&&this[y].mlist&&this[y].mlist.length==1){this[y]=this[y].mlist[0]}}}};t.Component={};t.Component.HasChildren={init:function(){this.children=[]},nchildren:function(){return this.children.length},_addchild:function(ag){this.children.push(ag);return this},_removechild:function(ag){this.children=this.children.filter(function(ah){return ah!==ag});return this},lastchild:function(){return this.children[this.children.length-1]},die:function(){for(var ag=0;ag<this.children.length;++ag){this.children[ag].die()}},think:function(){for(var ag=0;ag<this.children.length;++ag){this.children[ag].think.apply(this.children[ag],arguments)}},draw:function(ah){for(var ag=0;ag<this.children.length;++ag){ah.save();this.children[ag].draw(ah);ah.restore()}}};t.Component.SortChildren={init:function(ag){this.childsortfunc=ag||function(ai,ah){return ai.z-ah.z}},addchild:function(ag){this.children.sort(this.childsortfunc)}};t.Component.HasParent={init:function(ag){this.attachto(ag)},attachto:function(ag){if(this.parent){this.parent._removechild(this)}this.parent=ag;if(this.parent){this.parent._addchild(this)}return this},detach:function(){return this.attachto()},die:function(){return this.detach()}};t.scenes.play={start:function(){af.init();this.mode="play";this.buildoff=[0,0];this.vplatform=new q(0,0,aa.psize);var ag=t.texture.stone({size:512,scale:16});ag.context.drawImage(t.texture.roughshade({size:512}),0,0);this.backdrop=document.createElement("canvas");this.backdrop.width=this.backdrop.height=512;t.draw(this.backdrop.getContext("2d"),"[ drawimage0",ag,"] fs rgba(0,0,0,0.5) f0");s.focus=af.you;s.think(1);w("song"+af.njump)},thinkargs:function(ag){return[ag,t.key.state()]},think:function(ak,ag){if(this.mode=="play"){if(ag.down.up&&af.you.kjump<af.njump){af.you.leap()}if(af.you.hanging&&!ag.pressed.up){af.you.hanging=0}if(af.you.parent&&ag.down.down){af.you.drop()}af.you.hmove((ag.pressed.right?1:0)-(ag.pressed.left?1:0));if(ag.down.space){if(af.nearhouse(af.you)){af.talk(af.nearhouse(af.you))}else{if(af.canbuild){this.mode="build";this.vplatform.x=Math.floor(af.you.x)+this.buildoff[0];this.vplatform.y=Math.floor(af.you.y)+this.buildoff[1]}}}if(af.canwarp&&ag.down.tab){while(true){var aj=t.random.choice(Object.keys(A));if(!af.done["know"+aj]||!af.done["rescue"+aj]){continue}if(af.you.parent&&af.you.parent.house&&af.you.parent.house.name==aj){continue}af.lastlanding=af.houses[aj].parent;af.resetfall();z("warp");break}}if(G&&ag.down.F4&&af.you.parent){af.removeplatform(af.you.parent);af.you.drop()}if(G&&ag.down.F5){this.vplatform.dx=aa.psize-=1}if(G&&ag.down.F6){this.vplatform.dx=aa.psize+=1}if(G&&ag.down.F7&&af.you.parent){af.you.parent.ischeck=!af.you.parent.ischeck}if(G&&ag.down.F11){af.dump()}if(G&&ag.down.F9){af.sun=true;af.canwarp=true;af.canbuild=true;for(aj in A){af.done["know"+aj]=true}for(aj in A){af.done["rescue"+aj]=true}af.njump=3;af.jhang=3}if(G&&ag.down.F2){T()}}else{if(this.mode=="build"){if(ag.down.left){this.buildoff[0]-=1}if(ag.down.right){this.buildoff[0]+=1}if(ag.down.up){this.buildoff[1]+=1}if(ag.down.down){this.buildoff[1]-=1}this.vplatform.x=Math.floor(af.you.x)+this.buildoff[0];this.vplatform.y=Math.floor(af.you.y)+this.buildoff[1];if(!ag.pressed.space){if(af.canplace(this.vplatform)){var al=new C(this.vplatform.x,this.vplatform.y,this.vplatform.dx);af.platforms.push(al);af.newplatforms.push(al);af.sortplatforms();af.gp-=aa.pcost}this.mode="play"}}else{if(this.mode=="fly"){if(ag.down.left){af.you.x-=1}if(ag.down.right){af.you.x+=1}if(ag.down.up){af.you.y+=1}if(ag.down.down){af.you.y-=1}if(ag.down.np4){af.you.x-=5}if(ag.down.np6){af.you.x+=5}if(ag.down.np2){af.you.y-=5}if(ag.down.np8){af.you.y+=5}}}}if(G&&ag.down.F3){this.mode=this.mode=="fly"?"play":"fly"}if(this.mode=="fly"){af.you.think(0);af.you.parent=null}else{af.you.think(ak);if(!af.you.parent&&af.you.vy<0){af.forplatforms(af.you.y-1,af.you.oldy+1,function(an){if(an.catches(af.you)){af.you.land(an)}})}if(af.you.y<af.lastlanding.y-aa.maxfall){af.you.takedamage(1);af.resetfall()}var ai=af.you.x,ah=af.you.y+0.3,am=0.2;af.effects=af.effects.filter(function(ao,an){ao.think(ak);return ao.alive});af.splats=af.splats.filter(function(ao,an){ao.think(ak);return ao.alive});af.monsters=af.monsters.filter(function(an){if(!an.alive){return false}an.think(ak);if(an.hits(ai,ah,am)){if(!af.you.tmercy){af.you.takedamage(1)}}return true})}if(this.mode=="build"){this.vplatform.think(ak)}s.think(ak);af.checksectors();if(af.you.hp<=0){t.scene.swap("death")}},draw:function(){var aF=-s.x0*s.z/2,aj=s.y0*s.z/2;t.draw("fs #600 f0 [ t",aF,aj);var ax=Math.floor(-aF/512),aw=1+Math.floor((-aF+i.width)/512);var ai=Math.floor(-aj/512),ah=1+Math.floor((-aj+i.height)/512);for(var aB=ax;aB<aw;++aB){for(var az=ai;az<ah;++az){t.draw("drawimage",this.backdrop,512*aB,512*az)}}t.draw("]");if(af.you.y>140){var ak=Math.min(Math.max((af.you.y-140)/20,0),1);t.draw("fs rgba(220,220,255,"+ak+") f0")}ae.save();s.transform();function ap(aH){if(!s.visible(aH.x,aH.y,aH.r||0.5)){return}ae.save();aH.draw();ae.restore()}af.forplatforms(s.ymin,s.ymax,ap);af.buildings.forEach(ap);af.monsters.forEach(ap);ap(af.you);if(this.mode=="build"){ap(this.vplatform)}af.effects.forEach(ap);af.splats.forEach(ap);ae.restore();if(!af.sun){var an=i.width/2,ay=i.height/2,av=aa.rmask*s.z;var aC=t.random(0.5,0.52);var aA=t.random(0.7,0.72);var aG=af.you.tmercy?Math.floor(128*af.you.tmercy/aa.tmercy):0;var al=t.draw.radgrad(an,ay,0,an,ay,av,0,"rgba("+aG+",0,0,0.5)",aC,"rgba("+aG+",0,0,0.5)",aA,"rgba("+aG+",0,0,0.55)",1,"rgba("+aG+",0,0,1)");t.draw("fs",al,"f0")}var aE=0.4*Math.min(i.width,i.height)/s.z;t.draw("[ t",i.width/2,i.height/2,"z",0.01*s.z,0.01*s.z);for(var aD in af.houses){if(!af.done["know"+aD]){continue}var ao=af.houses[aD];var ar=ao.x-s.x0,aq=ao.y-s.y0;var av=Math.sqrt(ar*ar+aq*aq),au=av/aE;if(au<1){continue}var am=Math.atan2(-ar,-aq);t.draw("[ r",am,"t 0",100*aE,"( m 0 200 l -50 0 l 50 0 ) fs #006 f ss #666 lw 5 s","t 0 -50 r",-am,"fs white ss black textalign center font 60px~'Pirata~One' sh black 2 2 0 ft0",A[aD],"]")}t.draw("]");if(af.nearhouse(af.you)){var at="House~of~"+A[af.nearhouse(af.you).name]+"~(Space:~talk)";t.draw("fs white font 22px~'Sansita~One' textalign center","[ t",i.width/2,i.height*0.7,"ft0",at,"]")}var ag=[];ag.push("Depth: "+(170-Math.floor(af.you.y))+" fathoms");ag.push("Health: "+af.you.hp+"/"+af.you.maxhp);if(af.jhang){ag.push("GP: "+(af.gp>100000?"unlimited":af.gp))}ag.push("Left/right or A/D: move");ag.push("Down or S: drop");if(af.jhang){ag.push("Up or W: Slash (hold to glide)")}else{ag.push("Up or W: Jump")}if(af.canbuild){ag.push("Hold Space + use arrows: Build (cost "+aa.pcost+"GP)")}if(af.canwarp){ag.push("Tab: warp to random House.")}if(G){ag=ag.concat([t.ticker.getrates(),"pos: "+Math.floor(af.you.x)+", "+Math.floor(af.you.y),"F3: toggle fly mode","F4: destroy parent","F5/F6: adjust psize "+aa.psize,"F7: toggle checkpoint","F11: dump state"])}var aD=Math.floor(i.height/30);t.draw("fs white textalign left font",aD+"px~'Sansita~One'");ag.forEach(function(aI,aH){t.draw("[ t 4",aD*1.3*(aH+1),"ft0",aI.replace(/ /g,"~"),"]")});if(this.mode=="build"&&af.gp<aa.pcost){t.draw("[ t",i.width/2,i.height*0.2,"textalign center font",aD+"px~'Sansita~One' fs red ss black lw 1","fst0 platforms~require~"+aa.pcost+"gp ]")}else{if(this.mode=="build"&&this.vplatform.y>110){t.draw("[ t",i.width/2,i.height*0.2,"textalign center font",aD+"px~'Sansita~One' fs red ss black lw 1","fst0 platforms~cannot~be~built~above~60~fathoms ]")}}}};function T(){console.log("world map time");var ai=i,ah=ae;i=document.createElement("canvas");ae=i.getContext("2d");t.draw.setcontext(ae);i.width=i.height=1600;s.x0=0;s.y0=40;s.z=4;t.draw("fs black f0");ae.save();s.transform();for(var aj=-210;aj<200;aj+=20){t.draw("lw 20 ss #222 b m -20000",100*aj,"l 20000",100*aj,"s");t.draw("[ fs #444 font 400px~'Sansita~One' t -15000",100*aj,"vflip ft0",(170-aj)+"~fathoms ]")}function ag(ak){ae.save();ak.draw();ae.restore()}af.platforms.forEach(ag);af.buildings.forEach(ag);af.buildings.forEach(function(ak){t.draw("[ t",100*ak.x,100*(ak.y+3),"fs #AAA font 600px~'Pirata~One' vflip textalign center ft0",A[ak.name],"]")});ae.restore();window.open(i.toDataURL());i=ai;ae=ah;t.draw.setcontext(ae)}var af={init:function(){this.effects=[];this.splats=[];this.buildings=[];this.houses={};this.taken={};this.platforms=[];this.newplatforms=[];this.hsectors={};this.addhouse(0,0,"elgo");this.addhouse(-2,1,"wari");this.addhouse(3,1,"semt");this.addhouse(-3,3,"pald");this.addhouse(0,5,"lume");this.addhouse(2,3,"lige");this.addhouse(-3,-4,"sank");this.addhouse(-6,4,"mian");this.addhouse(3,8,"sarf");this.load(t.resource.data.gamedata);this.you=new m(this.houses.elgo.x,this.houses.elgo.y+4);this.sortplatforms();this.monsters=[];this.basesector=null;this.filledsectors={};this.njump=1;this.jhang=0;this.canbuild=false;this.canwarp=false;this.sun=false;this.gp=0;this.builddepth=110;this.lastlanding=this.houses.elgo.parent;this.done={knowelgo:true,rescueelgo:true,rescuewari:true,rescuesarf:true};this.bosses={semt:[],pald:[],lume:[],lige:[],sank:[],mian:[]};this.loadgame()},resetfall:function(){this.you.x=this.lastlanding.x+this.lastlanding.dx*0.5;this.you.y=this.lastlanding.y+0.8;this.you.kjump=999;this.you.drop()},addhouse:function(am,ak,ah){var ag=(am+0.5)*aa.sectorsize,al=(ak+0.5)*aa.sectorsize;var aj=new C(ag-4,al,8);var ai=new O(ag,al,ah);ai.parent=aj;aj.house=ai;this.buildings.push(ai);this.platforms.push(aj);this.houses[ah]=ai;this.hsectors[am+","+ak]=ai},nearhouse:function(ag){if(!ag.parent){return false}if(!ag.parent.house){return false}if(Math.abs(ag.x-ag.parent.house.x)>2){return false}if(!this.done["rescue"+ag.parent.house.name]){return false}return ag.parent.house},talk:function(ag){l["talk"+ag.name]();this.you.hp=this.you.maxhp;this.gp=Math.max(this.gp,aa.housegp);this.savegame()},sortplatforms:function(){this.platforms.sort(function(ah,ag){return ah.y-ag.y})},claimtiles:function(ag){var ai=ag.y;this.taken[ai]=this.taken[ai]||{};for(var ah=0;ah<ag.dx;++ah){this.taken[ai][ag.x+ah]=1}},removeplatform:function(ag){this.platforms=this.platforms.filter(function(ai){return ai!==ag});this.taken={};for(var ah=0;ah<this.platforms.length;++ah){this.claimtiles(this.platforms[ah])}},canplace:function(ag){var ai=ag.y;if(ai>this.builddepth){return false}if(this.gp<aa.pcost){return false}if(!this.taken[ai]){return true}for(var ah=0;ah<ag.dx;++ah){if(this.taken[ai][ag.x+ah]){return false}}return true},fillsector:function(an,am){var ap=aa.sectorsize;var aj=this.hsectors[an+","+am];if(aj){if(this.done["rescue"+aj.name]){return}var al=aj.x,ak=aj.y+1;this.bosses[aj.name]=[];if(aj.name=="semt"){for(var ag=0;ag<9;++ag){this.bosses[aj.name].push(new ac(al,ak,ag/9))}}else{if(aj.name=="pald"){for(var ag=0;ag<11;++ag){this.bosses[aj.name].push(new U(al,ak,ag/11))}}else{if(aj.name=="lume"){for(var ag=0;ag<10;++ag){this.bosses[aj.name].push(new S(al,ak))}}else{if(aj.name=="lige"){for(var ag=0;ag<9;++ag){this.bosses[aj.name].push(new ac(al,ak,ag/9));this.bosses[aj.name].push(new S(al,ak))}}else{if(aj.name=="mian"){for(var ag=0;ag<11;++ag){this.bosses[aj.name].push(new U(al,ak,ag/11));this.bosses[aj.name].push(new S(al,ak))}}else{if(aj.name=="sank"){for(var ag=0;ag<11;++ag){this.bosses[aj.name].push(new U(al,ak,ag/11));this.bosses[aj.name].push(new ac(al,ak,ag/11))}}}}}}}}else{if(am<8){var ah=16;var ai=2*Math.max(this.you.maxhp-3,0);var ao=4*Math.max(this.you.maxhp-5,0);t.random.spread(200).forEach(function(ar){var aq=t.random(200);aq-=ah;if(aq<0){new B(ap*(an+ar[0]),ap*(am+ar[1]));return}aq-=ai;if(aq<0){new N(ap*(an+ar[0]),ap*(am+ar[1]));return}aq-=ao;if(aq<0){new b(ap*(an+ar[0]),ap*(am+ar[1]));return}})}}},clearsector:function(ag){this.monsters=this.monsters.filter(function(ah){return ah.sectorkey!=ag})},checksectors:function(){var ag=Math.floor(this.you.x/aa.sectorsize);var al=Math.floor(this.you.y/aa.sectorsize);var ak=ag+","+al;if(this.basesector==ak){return}var ah={};for(var ao=-1;ao<=1;++ao){for(var an=-1;an<=1;++an){var aj=ag+ao,ai=al+an,am=aj+","+ai;if(!this.filledsectors[am]){this.fillsector(aj,ai)}ah[am]=1}}for(var am in this.filledsectors){if(!ah[am]){this.clearsector(am)}}this.basesector=ak;this.filledsectors=ah;console.log(this.monsters.length)},forplatforms:function(ak,aj,al){var ah=0,ag=this.platforms.length;while(ah+1<ag){var ai=Math.floor((ah+ag)/2);if(this.platforms[ai].y>ak){ag=ai}else{ah=ai}}for(;ah<this.platforms.length&&this.platforms[ah].y<=aj;++ah){al(this.platforms[ah])}},checkbosses:function(){for(var ag in this.bosses){if(this.done["rescue"+ag]){continue}if(this.bosses[ag].length&&!this.bosses[ag].some(function(ah){return ah.alive})){delete this.bosses[ag];this.done["rescue"+ag]=true;z("defeat");this.savegame();console.log("saved",ag)}}},dump:function(){var ah=this.platforms.filter(function(ai){return !ai.house}).map(function(ai){return[ai.x,ai.y,ai.dx,ai.ischeck?1:0]});var ag={pdata:ah};window.open("data:text/json,"+JSON.stringify(ag))},load:function(aj){for(var ah=0;ah<aj.pdata.length;++ah){var ai=aj.pdata[ah];var ag=new C(ai[0],ai[1],ai[2]);if(ai[3]){ag.ischeck=true}this.platforms.push(ag)}},gamename:"adastrasave",savegame:function(){console.log("saving");var ah=this.newplatforms.map(function(ai){return[ai.x,ai.y,ai.dx]});var ag={youpos:[this.you.x,this.you.y],maxhp:this.you.maxhp,done:this.done,njump:this.njump,jhang:this.jhang,canbuild:this.canbuild,canwarp:this.canwarp,gp:this.gp,pdata:ah,sun:this.sun};localStorage[this.gamename]=JSON.stringify(ag)},loadgame:function(){if(!localStorage[this.gamename]){return null}var aj=JSON.parse(localStorage[this.gamename]);this.you.x=aj.youpos[0];this.you.y=aj.youpos[1]+0.4;this.you.hp=this.you.maxhp=aj.maxhp;this.you.drop();this.done=aj.done;this.njump=aj.njump;this.jhang=aj.jhang;this.canbuild=aj.canbuild;this.canwarp=aj.canwarp;this.gp=aj.gp;this.sun=aj.sun;for(var ah=0;ah<aj.pdata.length;++ah){var ai=aj.pdata[ah];var ag=new C(ai[0],ai[1],ai[2]);console.log(ag);this.platforms.push(ag);this.newplatforms.push(ag)}this.sortplatforms()}};var j={setpos:function(ag,ah){this.x=ag;this.y=ah},draw:function(){t.draw("t",this.x*100,this.y*100)}};var p={think:function(ah){if(this.parent){if(!this.parent.supports(this)){this.drop();this.kjump=1;this.y+=0.002}}else{if(this.upward){var ai=Math.min(aa.vyup*ah,this.dup);this.y+=ai;this.dup-=ai;if(this.dup==0){this.drop()}}else{if(this.hover){this.hover=Math.max(this.hover-ah,0)}else{this.oldy=this.y;if(this.hanging){var ag=-aa.ahang;this.hanging=Math.max(this.hanging-ah,0)}else{var ag=this.ay}this.y+=ah*this.vy+0.5*ah*ah*ag;this.vy+=ah*ag}}}},drop:function(){this.upward=false;this.hover=aa.hover;this.y-=0.001;this.vy=0;this.ay=-aa.aydown;this.parent=null},land:function(ag){this.kjump=0;this.parent=ag;this.y=this.parent.y;this.vy=0;this.upward=false;this.hover=false}};var u={init:function(ag){this.maxhp=ag||1;this.alive=true},heal:function(ag){if(ag===undefined){this.hp=this.maxhp}else{this.hp=Math.min(this.hp+ag,this.maxhp)}},takedamage:function(ag){if(this.hp<=0){return}this.hp=Math.max(this.hp-ag,0);if(this.hp<=0){this.die()}},die:function(){this.alive=false}};var W={takedamage:function(){new Y(this.x,this.y,1)}};var V={init:function(ag){this.amt=ag||1},die:function(){z("pickup");af.gp+=this.amt}};var c={takedamage:function(){this.tmercy=aa.tmercy},think:function(ag){this.tmercy=Math.max(this.tmercy-ag,0)},draw:function(){if(!this.tmercy){return}t.draw("alpha",this.tmercy*20%2>=1?0.1:0.9)}};var r={hmove:function(ag){this.vx=(ag||0)*aa.vx},think:function(ag){this.x+=this.vx*ag}};var P={supports:function(ag){return ag.x>=this.x&&ag.x<=this.x+this.dx},catches:function(ag){return ag.y<this.y&&ag.oldy>=this.y&&this.supports(ag)}};var D={leap:function(){z("jump");this.kjump+=1;this.parent=null;this.upward=true;this.dup=aa.dup;this.hanging=aa.hangtimes[af.jhang];if(af.jhang>0){new Q(this.x,this.y+0.3,aa.slashsizes[af.jhang])}}};var k={init:function(ag){this.color=ag||"white"},draw:function(){var ag=this.ischeck?"yellow":this.color;t.draw("ss",ag,"lw 8 b m 0 0 l",this.dx*100,"0 s")}};var F={init:function(ag){this.color=ag||"white"},draw:function(){if(!G){return}var ag=this.ischeck?"yellow":this.color;t.draw("ss",ag,"lw 8 b m 0 0 l",this.dx*100,"0 s")}};var ad={think:function(ag){this.color=af.canplace(this)?"white":"red"}};var o={init:function(aj,ah,ai,ag){this.dx=aj||3;this.dy=ah||1;this.omegax=ai||1.1;this.omegay=ag||1.6},settrack:function(ag,ah){this.tfly=0;this.x0=ag;this.y0=ah},think:function(ag){this.tfly+=ag;this.x=this.x0+this.dx*Math.sin(this.tfly*this.omegax);this.y=this.y0+this.dy*Math.sin(this.tfly*this.omegay)}};var X={init:function(){this.tpulse=0;this.dx0=this.dx;this.dy0=this.dy},think:function(ag){this.tpulse+=ag;this.dx=(1+0.4*Math.sin(2*this.tpulse))*this.dx0;this.dy=(1+0.4*Math.cos(2*this.tpulse))*this.dy0}};var f={init:function(ag,ai,ah,aj){this.r0=ag||1;this.dr=ai||0.8;this.omegar=ah||5;this.omegap=aj||1},settrack:function(ag,ah){this.tfly=0;this.x0=ag;this.y0=ah},think:function(ai){this.tfly+=ai;var ah=this.r0+this.dr*Math.sin(this.tfly*this.omegar);var ag=this.tfly*this.omegap;this.x=this.x0+2*ah*Math.sin(ag);this.y=this.y0+0.6*ah*Math.cos(ag)}};var H={init:function(ai,ag,ah){this.dx=ai||1;this.dy=ag||1;this.v=ah||3},settrack:function(ag,ah){this.tfly=0;this.x0=ag;this.y0=ah;this.x=this.x0;this.y=this.y0},think:function(ai){this.tfly+=ai;if(!this.target){this.target=[this.x0+this.dx*t.random(-1,1),this.y0+this.dy*t.random(-1,1)]}var ah=this.target[0]-this.x,ag=this.target[1]-this.y;var aj=Math.sqrt(ah*ah+ag*ag);if(aj<this.v*ai){this.x=this.target[0];this.y=this.target[1];this.target=null;return}this.x+=(this.v*ai)*ah/aj;this.y+=(this.v*ai)*ag/aj}};var R={init:function(ag){this.r=ag||0},hits:function(ag,ai,ah){return Math.abs(ag-this.x)<ah+this.r&&Math.abs(ai-this.y)<ah+this.r}};var n={die:function(){af.checkbosses()}};var I={settrack:function(ag,ah){var aj=Math.floor(ag/aa.sectorsize);var ai=Math.floor(ah/aa.sectorsize);this.sectorkey=aj+","+ai}};function m(ag,ah){this.setpos(ag,ah);this.parent=null;this.kjump=999;this.drop();this.heal()}m.prototype=t.Thing().addcomp(j).addcomp(p).addcomp(D).addcomp(r).addcomp(u,3).addcomp(c).addcomp({draw:function(){if(af.jhang){var ag=this.upward||this.hover?-0.9:this.parent||this.hanging?0.15:0.8;t.draw("fs white [ t 0 50 r",ag,"( m 0 0 l 80 0 l 40 20 ) f ]");t.draw("fs white [ t 0 50 r",-ag,"( m 0 0 l -80 0 l -40 20 ) f ]")}t.draw("fs green ( m -25 0 l -15 60 l 15 60 l 25 0 ) f")},land:function(ag){af.lastlanding=ag;if(ag.ischeck){af.savegame()}},takedamage:function(){z("hurt")}});function C(ag,aj,ah){this.setpos(ag,aj);this.dx=ah;af.claimtiles(this);var ai=t.random.rand(100,120)+","+t.random.rand(100,120)+","+t.random.rand(100,120);this.grad=t.draw.lingrad(0,0,0,-100,0,"rgb("+ai+")",1,"rgba("+ai+",0)")}C.prototype=t.Thing().addcomp(j).addcomp(P).addcomp({draw:function(){t.draw("fs",this.grad,"fr 0 -100",this.dx*100,100)}}).addcomp(F,"#266");function q(ag,ai,ah){this.setpos(ag,ai);this.dx=ah}q.prototype=t.Thing().addcomp(j).addcomp(k,"white").addcomp(ad);function O(ag,ai,ah){this.setpos(ag,ai);this.name=ah;this.r=3}O.prototype=t.Thing().addcomp(j).addcomp({draw:function(){t.draw("fs #424 ss #848 lw 8 ( m -85 0 q -85 100 0 200 q 85 100 85 0 ) f s");t.draw("fs #242 ss #484 lw 8 ( m -20 0 c -20 100 -100 100 -60 180 c -50 100 50 100 60 180 c 100 100 20 100 20 0 ) f s");t.draw("fs #224 ss #448 lw 8 ( m -100 0 q 0 -20 100 0 q 100 15 90 30 q 0 18 -90 30 q -100 15 -100 0 ) f s")}});function B(ag,ah){this.setpos(ag,ah);this.settrack(ag,ah);this.tfly=t.random(1000);this.heal();af.monsters.push(this)}B.prototype=t.Thing().addcomp(j).addcomp(I).addcomp(o,3,1,0.7,0.4).addcomp(R,0.2).addcomp(u,1).addcomp(V,1).addcomp(W).addcomp({draw:function(){var ag=20*[0,1,0,-1][Math.floor(this.tfly*20%4)];t.draw("ss #B00 lw 5 b m -50",ag,"l 0 0 l 50",ag,"s");t.draw("fs #700 fr -20 -20 40 40")}});function N(ag,ah){this.setpos(ag,ah);this.settrack(ag,ah);this.tfly=t.random(1000);this.heal();af.monsters.push(this)}N.prototype=t.Thing().addcomp(j).addcomp(I).addcomp(o,5,3,0.7,1.2).addcomp(R,0.3).addcomp(u,1).addcomp(V,2).addcomp(W).addcomp({draw:function(){var ag=20*[0,1,0,-1][Math.floor(this.tfly*20%4)];t.draw("z 1.5 1.5 ss #BB0 lw 5 b m -50",ag,"l 0 0 l 50",ag,"s");t.draw("fs #770 fr -20 -20 40 40")}});function b(ag,ah){this.setpos(ag,ah);this.settrack(ag,ah);this.tfly=t.random(1000);this.heal();af.monsters.push(this)}b.prototype=t.Thing().addcomp(j).addcomp(I).addcomp(o,5,3,0.7,1.2).addcomp(R,0.4).addcomp(u,1).addcomp(V,3).addcomp(W).addcomp({draw:function(){var ag=20*[0,1,0,-1][Math.floor(this.tfly*20%4)];t.draw("z 2 2 ss #0BB lw 5 b m -50",ag,"l 0 0 l 50",ag,"s");t.draw("fs #077 fr -20 -20 40 40")}});function ac(ag,ai,ah){this.setpos(ag,ai);this.settrack(ag,ai);this.tfly=K*ah;this.heal();af.monsters.push(this)}ac.prototype=t.Thing().addcomp(j).addcomp(I).addcomp(o,2,1,1,2).addcomp(X).addcomp(R,0.4).addcomp(u,1).addcomp(W).addcomp(n).addcomp({draw:function(){t.draw("r",this.tfly*5%K);t.draw("ss #B00 lw 5 b m -80 0 l 80 0 m 0 -80 l 0 80 s");t.draw("fs #700 fr -30 -30 60 60")},die:function(){z("explosion")}});function U(ag,ai,ah){this.setpos(ag,ai);this.settrack(ag,ai);this.tfly=K*ah;this.heal();af.monsters.push(this)}U.prototype=t.Thing().addcomp(j).addcomp(I).addcomp(f).addcomp(R,0.4).addcomp(u,1).addcomp(W).addcomp(n).addcomp({draw:function(){t.draw("r",this.tfly*5%K);t.draw("ss #B00 lw 5 b m -80 0 l 80 0 m 0 -80 l 0 80 s");t.draw("fs #700 fr -30 -30 60 60")},die:function(){z("explosion")}});function S(ag,ah){this.setpos(ag,ah);this.settrack(ag,ah);this.tfly=t.random(100);this.heal();af.monsters.push(this)}S.prototype=t.Thing().addcomp(j).addcomp(I).addcomp(H,5,2,5).addcomp(R,0.4).addcomp(u,1).addcomp(W).addcomp(n).addcomp({draw:function(){t.draw("r",this.tfly*5%K);t.draw("ss #B00 lw 5 b m -80 0 l 80 0 m 0 -80 l 0 80 s");t.draw("fs #700 fr -30 -30 60 60")},die:function(){z("explosion")}});var J={init:function(ag){this.t0=ag||1},live:function(){this.t=this.t0;this.alive=true},think:function(ag){this.t=Math.max(this.t-ag,0);this.f=1-this.t/this.t0;this.alive=this.t>0}};var ab={draw:function(){t.draw("alpha",1-this.f)}};var L={init:function(ag){this.dhp=ag||1},think:function(ai){var ag=this.x,aj=this.y,ah=this.r;af.monsters.forEach(function(ak){if(ak.hits(ag,aj,ah)){if(!ak.tmercy){ak.takedamage(1)}}})}};function Q(ag,ai,ah){this.setpos(ag,ai);this.r=ah;this.live();af.effects.push(this)}Q.prototype=t.Thing().addcomp(j).addcomp(J,0.4).addcomp(ab).addcomp(L).addcomp({draw:function(){var ag=130*this.r*(0.5+0.5*this.f);t.draw("ss rgba(255,255,0,0.5) lw 10","b a 0 0",ag,"-0.9 0.9 s","b a 0 0",ag,"2.24 4.04 s")}});var s={x0:0,y0:0,z:32,focus:null,zoverride:0,think:function(ag){this.z=this.zoverride||Math.min(i.width,i.height)/(af.sun?26:18);if(this.focus){var ah=Math.min(10*ag,1);this.x0+=(this.focus.x-this.x0)*ah;this.y0+=(this.focus.y-this.y0)*ah}this.ymin=this.y0-i.height/this.z*0.55;this.ymax=this.y0+i.height/this.z*0.55;this.xmin=this.x0-i.width/this.z*0.55;this.xmax=this.x0+i.width/this.z*0.55},transform:function(){t.draw("t",i.width/2,i.height/2,"z",this.z,-this.z,"t",-this.x0,-this.y0,"z 0.01 0.01")},visible:function(ag,ai,ah){return ag>this.xmin-ah&&ag<this.xmax+ah&&ai>this.ymin-ah&&ai<this.ymax+ah}};var aa={vyup:20,dup:1.1,hover:0.15,aydown:40,vx:6,hangtimes:[0,0.2,0.3,0.4,0.5,0.6],slashsizes:[0,0.8,1.1,1.4,1.7,2],ahang:1.4,tmercy:1.6,sectorsize:20,psize:3,maxfall:8,rmask:10,pcost:5,housegp:20,musicvolume:0.4};var v={};var E=window.location.search.slice(1);E.split("&").forEach(function(ag){var ah=ag.split("=");if(ah.length==1){v[ah[0]]=true}if(ah.length==2){v[ah[0]]=JSON.parse(decodeURIComponent(ah[1]))}});var G=v.DEBUG;var e={init:function(ah,ag){this.nparticles=ah||10;this.color=ag||"white"},start:function(){this.particles=[];while(this.particles.length<this.nparticles){this.particles.push(t.random.rdisk())}},draw:function(){var ah=this.r*(0.3+0.7*this.f),ag=0.1/ah;t.draw("z",100*ah,100*ah,"fs",this.color);this.particles.forEach(function(ai){t.draw("b o",ai[0],ai[1],ag,"f")})}};var M={init:function(ag){this.g=ag||40},think:function(ag){this.y+=this.vy*ag-0.5*ag*ag*this.g;this.vy-=ag*this.g}};function Y(ag,ai,ah){this.setpos(ag,ai);this.r=ah;this.vy=5;this.start();this.live();af.splats.push(this);this.think(0)}Y.prototype=t.Thing().addcomp(j).addcomp(J,0.5).addcomp(ab).addcomp(M).addcomp(e,20,"rgba(255,0,0,0.5)");var l={talkelgo:function(){if(this.newcutscene("mission1")){af.done.knowwari=true}else{this.cutscene("healinfo")}},talkwari:function(){if(this.newcutscene("mission2")){af.jhang=1;af.done.knowsemt=true;af.you.maxhp+=1}else{this.cutscene("wingusage")}},talksemt:function(){if(this.newcutscene("mission3")){af.canbuild=true;af.done.knowpald=true;af.you.maxhp+=1}else{this.cutscene("buildusage")}},talkpald:function(){if(this.newcutscene("mission4")){af.canwarp=true;af.done.knowlume=true;af.you.maxhp+=1}else{this.cutscene("warpusage")}},talklume:function(){if(this.newcutscene("mission5")){af.done.knowmian=true;af.done.knowlige=true;af.done.knowsank=true;af.you.maxhp+=1;af.njump+=1}else{if(!af.done.rescuelige){this.cutscene("tosavelige")}else{if(!af.done.rescuesank){this.cutscene("tosavesank")}else{if(!af.done.rescuemian){this.cutscene("tosavemian")}else{if(this.newcutscene("restoresun")){af.njump+=1;af.you.maxhp+=1;af.sun=true;af.gp+=999999999}else{this.cutscene("seeksart")}}}}}},talklige:function(){if(this.newcutscene("getinfolige")){af.you.maxhp+=1;af.jhang+=1}else{this.cutscene("complete")}},talksank:function(){if(this.newcutscene("getinfosank")){af.you.maxhp+=1;af.jhang+=1}else{this.cutscene("complete")}},talkmian:function(){if(this.newcutscene("getinfomian")){af.you.maxhp+=1;af.jhang+=1}else{this.cutscene("complete")}},talksarf:function(){t.scene.push("endscene")},cutscene:function(ag){t.scene.push("cutscene",x[ag])},newcutscene:function(ag){if(af.done[ag]){return false}af.done[ag]=true;t.scene.push("cutscene",x[ag]);return true}};var A={elgo:"Eldar",wari:"Avex",semt:"Kraftin",pald:"Zume",lume:"Brite",lige:"Mentix",sank:"Querda",mian:"Cogno",sarf:"Nirva"};var x={mission1:["Apprentice, my time is short. My thoughts of late have turned to Heaven.","You've heard the story of Heaven, yes? But do you know what that word means?","What we know as Heaven is in fact the surface of this world, which our ancestors abandoned 100 generations ago.","There is a place beyond the darkness, a place that might still be there, but this fact seems to have been forgotten by our people.","Promise me that you will keep this knowledge alive.","Go to the House of Avex. There you will find a powerful tool."],healinfo:["Remember, return to any House if you need to heal."],mission2:["There was once a lamp brighter than anything you can imagine, called the Artifical Sun.","But sadly it broke many years ago, before you were born.","How I wish you could have seen the daylight....","Since the Sun disappeared, the creatures of the darkness have grown bolder.","Will you sojourn at the House of Kraftin? I have not heard from them in ages and I fear the worst.","Received Wings! You now slash when you jump. Hold Up while jumping to hover."],wingusage:["Have you learned to use your wings?","Press Up near an enemy to slash it. Hold Up and you will hang in the air briefly."],mission3:["Thank you! Never have these creatures attacked Houses before. This is cause for alarm!","Our shelters have served us well for many centuries, but they are finally decaying.","Our ancestors were builders, you know. Very little existed here before they came.","Although most of their technologies have been lost, I can teach you one.","Press and hold Space to create a platform. Use Arrow keys to place it.","Platforms cost "+aa.pcost+"GP each. If you run low, slay some monsters or visit any House.","Please visit the House of Zume. I believe your path lies there."],buildusage:["Have you learned to build pathways?","Press and hold Space while standing on a platform.","Choose the placement with the arrow keys, then release Space to build.","What? You want to build a path to Heaven? No, it would never work.","These pathways cannot be built above 60 fathoms. Such technology is long lost, I'm afraid."],mission4:["Wow, close one. I don't know how much longer we can last.","Look, I know that mentor of yours likes old stories of Heaven and salvation, but we have real problems to deal with.","Right now we need to turn the Sun back on, before these attacks destroy us.","Find the House of Brite and see what can be done, if it's not too late.","Got warp! Press Tab to warp between Houses you've visited."],warpusage:["Press Tab at any time to warp to a random House that you've already visited.","Houses will refill your health and money (up to 20GP) and save your progress."],mission5:["This is where we once controlled the Artificial Sun, but we have not seen daylight in many years.","I could repair it, I know, if only I had replacement parts....","The technology of our ancestors is thought to be lost, but it is simply scattered.","Perhaps if you visit the Houses of Mentix, Querda, and Cogno, you may find what I need.","Learned Double Jump! Tap Up twice."],tosavelige:["Visit the Houses of Mentix, Querda, and Cogno to restore the Sun.","You still have not come back from Mentix."],tosavesank:["Visit the Houses of Mentix, Querda, and Cogno to restore the Sun.","You still have not come back from Querda."],tosavemian:["Visit the Houses of Mentix, Querda, and Cogno to restore the Sun.","You still have not come back from Cogno."],getinfolige:["The House of Brite seeks to restore the Sun?","Their retroencabulator must be broken, please take this replacement!","Wings upgraded!"],getinfosank:["The House of Brite seeks to restore the Sun?","Their improbability drive must be broken, please take this replacement!","Wings upgraded!","Er.... I don't really know how to get out of here. Better press Tab."],getinfomian:["The House of Brite seeks to restore the Sun?","Their flux capacitor must be broken, please take this replacement!","Wings upgraded!"],restoresun:["Amazing! With the parts you've collected, I think we may be able to restore the Sun....","....","Let there be light!","Got triple jump!","Got unlimited GP!"],seeksart:["Thanks to you, the light is restored.... for now.","You want to know if there is a path to Heaven? As in the actual Heaven?","Legend tells of one to the east, of course, but I'm sure it's long gone, if it ever existed.","Still...."],complete:["Good luck, young one."]};t.scenes.cutscene={start:function(ag){this.texts=ag.slice(0)},thinkargs:function(ag){return[ag,t.key.state()]},think:function(ah,ag){if(ag.down.space){this.texts.shift();if(!this.texts.length){t.scene.pop();z("powerup");w("song"+af.njump)}}},draw:function(){t.scenes.play.draw();t.draw("fs rgba(0,0,0,0.9) f0");if(!this.texts[0]){return}t.draw("[ fs white sh #00A 1 1 0 font 40px~'Pirata~One' textalign center");Z(this.texts[0],500,ae).forEach(function(ah,ag,ai){ae.fillText(ah,i.width/2,i.height/2+50*(ag-ai.length/2))});t.draw("]")}};t.scenes.endscene={start:function(ag){this.texts=["Whoa, you okay? Did you just come out of that hole in the ground?","You having trouble seeing? It's just sunlight. Let's get you inside.","Now, how long have you been down there? Your whole life?!","What? Is this 'Heaven'? Yeah sure, whatever you want. Just sit tight for a minute.","How many of you people are underground? A whole race?! Holy smokes, what a find!","Hey, do you have an agent? Of course not, I'll be your agent. I'm your best friend, after all!","A race of subterranian people... hey, are you a cannibal? No? Okay, well, maybe we can say you are anyway.","I can see it now... front pages... talk shows... here we come!","Welcome to Heaven, kid, you're gonna love it!"]},thinkargs:function(ag){return[ag,t.key.state()]},think:function(ah,ag){if(ag.down.space){this.texts.shift();if(!this.texts.length){t.scene.pop();t.scene.swap("reset")}}},draw:function(){t.scenes.play.draw();t.draw("fs rgba(0,0,0,0.9) f0");if(!this.texts[0]){return}t.draw("[ fs white sh #00A 1 1 0 font 40px~'Pirata~One' textalign center");Z(this.texts[0],500,ae).forEach(function(ah,ag,ai){ae.fillText(ah,i.width/2,i.height/2+50*(ag-ai.length/2))});t.draw("]")}};function Z(am,ai,ah){ah=ah||ae;ai=ai||ah.canvas.width;var al=[am],an=0,ak;while(ah.measureText(al[an]).width>ai&&(ak=al[an].indexOf(" "))>-1){var aj=al[an],ag=aj.lastIndexOf(" ");while(ah.measureText(aj.substr(0,ag)).width>ai&&ag>ak){ag=aj.lastIndexOf(" ",ag-1)}al[an++]=aj.substr(0,ag);al.push(aj.substr(ag+1))}return al}var K=6.283185307179586;var i=document.getElementById("canvas");var ae=i.getContext("2d");t.draw.setcontext(ae);if(!G){t.key.watchlist="up down left right space tab".split(" ")}t.key.init();t.key.remaparrows(true);t.key.qdown=true;t.maximize.fill(i,"total");t.scenes.title={think:function(){if(d>=1&&t.key.ispressed.space){t.scene.swap("play")}},draw:function(){t.draw("fs #444 f0");t.draw("fs white ss black");var ag=Math.floor(Math.min(i.width/20,i.height/10));t.draw("[ lw 2 textalign center t",i.width/2,i.height/2);t.draw("font",2*ag+"px~'Piedra' fst Ad~Astra 0",-2.4*ag);t.draw("font",ag+"px~'Piedra' fst by~Christopher~Night 0 0");t.draw("font",ag+"px~'Piedra' fst Universe~Factory~Games 0",1.2*ag);if(d>=1){t.draw("font",1.4*ag+"px~'Piedra' fst press~Space~to~"+(localStorage.LD29save?"continue":"begin"),0,4*ag)}else{t.draw("font",1.4*ag+"px~'Piedra' fst Loading:~"+Math.round(100*d)+"%",0,4*ag)}t.draw("]")}};t.scenes.death={start:function(){this.t=0},think:function(ag){this.t+=ag;if(this.t>2){t.scene.swap("title")}},draw:function(){if(this.t<1){t.scenes.play.draw()}else{t.scenes.title.draw()}var ag=Math.min(Math.max(1-Math.abs(this.t-1),0),1);t.draw("[ fs red alpha",ag,"f0 ]")}};t.scenes.reset={start:function(){this.t=0},think:function(ag){this.t+=ag;if(this.t>2){t.scene.swap("title")}},draw:function(){if(this.t<1){t.scenes.play.draw()}else{t.scenes.title.draw()}var ag=Math.min(Math.max(1-Math.abs(this.t-1),0),1);t.draw("[ fs white alpha",ag,"f0 ]")}};var d=0;t.scene.init({ups:60,maxupf:6});t.scene.push("title");t.resource.onloading=function(ag){d=ag};t.resource.onload=function(){d=1;t.resource.mergesounds("jump")};function z(ag){try{t.resource.sounds[ag].play()}catch(ah){}}var h=null,a=aa.musicvolume;function w(ai){try{var ag=t.resource.sounds[ai];if(ag===h){return}if(h){h.pause()}ag.volume=a;ag.currentTime=0;ag.play();ag.loop=true;h=ag}catch(ah){}}t.resource.loadwebfonts("Viga","Pirata One","Sansita One","Piedra");t.resource.load({gamedata:"gamedata.json",jump0:"sfx/jump0.ogg",jump1:"sfx/jump1.ogg",jump2:"sfx/jump2.ogg",jump3:"sfx/jump3.ogg",hurt:"sfx/hurt.ogg",powerup:"sfx/powerup.ogg",pickup:"sfx/pickup.ogg",explosion:"sfx/explosion.ogg",warp:"sfx/warp.ogg",defeat:"sfx/defeat.ogg",song1:"sfx/cheese.ogg",song2:"sfx/hands.ogg",song3:"sfx/tired.ogg"})};</script>