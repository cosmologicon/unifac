<!DOCTYPE html>
<html>
<head>
<title>Twondy and Zoop graphics test</title>
<style>
body {
    background: black; color: white;
    font-family: 'Viga';
    font-size: 110%;
}
* {
    margin: auto;
    text-align: center;
}
</style>

<!-- UFX libraries -->
<script src="../UFX/src/ticker.js"></script>
<script src="../UFX/src/mouse.js"></script>
<script src="../UFX/src/key.js"></script>
<script src="../UFX/src/Thing.js"></script>
<script src="../UFX/src/draw.js"></script>
<script src="../UFX/src/random.js"></script>
<script src="../UFX/src/scene.js"></script>

<!-- game code -->
<script src="settings.js"></script>
<script src="camera.js"></script>
<script src="gamescene.js"></script>

<!-- game objects -->
<script src="stuff.js"></script>
<script src="structures.js"></script>
<script src="monsters.js"></script>
<script src="you.js"></script>
<script src="effects.js"></script>


<body>
<canvas id=canvas style="border: medium gray outset"></canvas>

<script>
var tau = 2 * Math.PI
function getdx(x0, x1) {
    return ((x1 - x0 + tau/2) % tau + tau) % tau - tau/2
}
var canvas = document.getElementById("canvas")
canvas.width = settings.sx ; canvas.height = settings.sy
var context = canvas.getContext("2d")

window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||  
                               window.webkitRequestAnimationFrame || window.msRequestAnimationFrame
UFX.key.init()
UFX.key.qup = false
UFX.key.qdown = true
UFX.key.watchlist = "up down left right 1 2".split(" ")
UFX.draw.setcontext(context)



// todo - move the world-drawing code into a separate module
//        so we don't have to initialize this
var gamestate = {
    worldr: 100,
    worldsize: 100*tau,
    setworldsize: function () {},
    njumps: 10,
    unlocked: { shock: true, },
    shocklevel: 10,
    
}
GameScene.start()

var zoom = 4

UFX.ticker.register(function (dt) {
    // Handle keyboard input
    var mkeys = {
        up: !!(UFX.key.ispressed.up || UFX.key.ispressed.W || UFX.key.ispressed.comma || UFX.key.ispressed["key#188"]),
        down: !!(UFX.key.ispressed.down || UFX.key.ispressed.S || UFX.key.ispressed.O),
        left: !!(UFX.key.ispressed.left || UFX.key.ispressed.A),
        right: !!(UFX.key.ispressed.right || UFX.key.ispressed.D || UFX.key.ispressed.E),
        act: !!(UFX.key.ispressed.space || UFX.key.ispressed.enter),
    }
    mkeys.act == mkeys.act || mkeys.down
    var nkeys = {}
    UFX.key.events().forEach(function (event) {
        if (event.type === "down") {
            nkeys[event.name] = true
            if (event.name === "1") {
                zoom *= 0.9
            } else if (event.name === "2") {
                zoom /= 0.9
            }
        }
    })
    nkeys.act = nkeys.down
    you.move(mkeys, nkeys)
    
    you.think(dt)
    you.updatestate()

    camera.x = you.x
    camera.y = you.y + 20
    camera.zoom = zoom

    
    context.fillStyle = "#333"
    context.fillRect(0, 0, settings.sx, settings.sy)
    context.save()
    camera.orient()
    GameScene.drawworld()
    you.draw()
    context.restore()
})


</script>


